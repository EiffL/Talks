<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>Merging deep learning with physical models for the analysis of modern cosmological surveys</title>

	<meta name="description" content="Oxford Seminar, October 20th 2020">
	<link rel="stylesheet" href="reveal.js/dist/reset.css">
	<link rel="stylesheet" href="reveal.js/dist/reveal.css">
	<link rel="stylesheet" href="reveal.js/dist/theme/darkenergy.css" id="theme">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css" id="highlight-theme">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section data-background-image="assets/lsst_stills_0009_crop.jpg">
				<div class="container">
					<div class="title" style="border-radius: 20px; background-color:rgba(0, 0, 0, 0.4);">
						<h1>Merging deep learning with physical models</h1>
						<h2> for the analysis of modern cosmological surveys</h2>
					</div>
				</div>
				<hr>
				<div style="border-radius: 20px; background-color:rgba(0, 0, 0, 0);">
					<div class="container">
						<div class="col">
							<div align="left" style="margin-left: 20px;">
								<h2>François Lanusse</h2>
								<br>
								<img src="assets/CosmoStatDarkBK.png" class="plain"></img>
								<br>
							</div>
						</div>

						<div class="col">
							<br>
							<br>
							<br>
							<br>
							<img src="assets/logo_cnrs.png" class="plain" height="150"></img>
						</div>

						<div class="col">
							<br>

							<br>
							<br>
							<img src="assets/aim.png" class="plain" height="150"></img>
						</div>
					</div>
					<div> slides at <a href="https://eiffl.github.io/talks/Oxford2020">eiffl.github.io/talks/Oxford2020</a> </div>
				</div>
			</section>

			<section data-background-image="assets/WMAP_timeline_large.jpg">
				<h3 class='slide-title' style="position:absolute;top:0;"> the $\Lambda$CDM view of the Universe </h3>
				<br> <br>
				<div class="container">
					<div class="col" style="flex: 0 0 40em;">

					</div>
					<div class="col">

						<img class="plain" data-src="assets/Euclid.png" style="width: 300px" />

						<img class="plain" data-src="assets/wfirstlogo.png" style="width: 300px" />

						<img class="plain" data-src="assets/vrro.png" style="width: 300px" />
					</div>
				</div>
				<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
			</section>

			<section>
				<section data-background-video="assets/animation-day-to-night.mov" data-background-video-muted>
					<h3 class='slide-title'>the Rubin Observatory Legacy Survey of Space and Time</h3>
					<div class="container">
						<div class="col">
							<ul>
								<li class="fragment fade-up"> 1000 images each night, 15 TB/night for 10 years</li>
								<br>
								<li class="fragment fade-up"> 18,000 square degrees, observed once every few days</li>
								<br>
								<li class="fragment fade-up"> Tens of billions of objects, each one observed $\sim1000$ times</li>
							</ul>
							<br>
							<!-- <p class="fragment fade-up"> $\Longrightarrow$ Incredible potential for discovery, along with <b>unprecedented challenges</b >.</p> -->
						</div>

						<div class="col">
							<video class="fragment fade-up" data-fragment-index="1" data-autoplay data-src="assets/obsim.mp4" type="video/mp4" />
						</div>
					</div>
				</section>

				<section data-transition="fade-in fade-out" data-background="assets/gal_sdss.png" data-vertical-align-top>
					<p>Previous generation survey: SDSS</p>
					<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
					<br> <br> <br> <br> <br> <br> <br>
					<div style="float:right; font-size: 20px">Image credit: Peter Melchior</div>
				</section>
				<section data-transition="fade-in fade-out" data-background="assets/gal_des.png" data-vertical-align-top>
					<p>Current generation survey: DES</p>
					<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
					<br> <br> <br> <br> <br> <br> <br>
					<div style="float:right; font-size: 20px">Image credit: Peter Melchior</div>
				</section>
				<section data-transition="fade-in fade-out" data-background="assets/gal_hsc.png" data-vertical-align-top>
					<p>LSST precursor survey: HSC</p>

					<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
					<br> <br> <br> <br> <br> <br> <br>
					<div style="float:right; font-size: 20px">Image credit: Peter Melchior</div>
				</section>
			</section>

			<section>
				<h3 class='slide-title'>The challenges of modern surveys</h3>
				<div style="float:left;">
					$\Longrightarrow$ Modern surveys will provide <b>large volumes</b> of <b>high quality</b> data
				</div>
				<br>
				<div class="container">
					<div class="col">

						<div class="block fragment">
							<div class="block-title">
								A Blessing
							</div>
							<div class="block-content">
								<ul>
									<li>Unprecedented statistical power
									</li>
									<br>
									<li>Great potential for new discoveries
									</li>
								</ul>
							</div>
						</div>

						<br>
						<div class="block fragment">
							<div class="block-title">
								A Curse
							</div>
							<div class="block-content">
								<ul>
									<li> Existing methods are reaching their limits at every
										step of the science analysis
									</li>
									<br>
									<li>Control of systematics is <b>paramount</b>
									</li>
								</ul>
							</div>
						</div>

					</div>
					<div class="col">
						LSST forecast on dark energy parameters
						<img class="plain" data-src="assets/LSST_forecast_Y10.png" style="height :400px;" />
					</div>
				</div>
				<div class="fragment">
					$\Longrightarrow$ Dire need for <b class="alert">novel analysis techniques</b> to fully realize the potential of modern surveys.
				</div>
			</section>

			<section>
				<section data-background="assets/gal_hsc.png">
					<h3 class='slide-title'>Can AI solve all of our problems?</h3>
					<div class="fragment">
						<div style="float:right; font-size: 20px">Branched GAN model for deblending <a href="https://arxiv.org/abs/1810.10098">(Reiman & Göhre, 2018)</a></div>

						<img class="plain" data-src="assets/Reiman2018_1.png" />
					</div>

					<div class="block fragment">
						<div class="block-title">
							The issue with using deep learning as a <i>black-box</i>
						</div>
						<div class="block-content">
							<ul>
								<li> No explicit control of noise, PSF, depth, number of sources.
									<ul>
										<li> Model would have to be retrained for all observing configurations
										</li>
									</ul>
								</li>
								<li> No guarantees on the network output (e.g. flux preservation, artifacts)
								</li>
								<li> No proper uncertainty quantification.
								</li>
							</ul>
						</div>
					</div>
				</section>

				<section>
					<img class="plain" data-src="assets/Reiman2018_3.png" />
				</section>
			</section>

			<section>
				<h3 class='slide-title'>Outline of this talk</h3>
				<br>
				<br>
				<h3> How can we merge <b>Deep Learning</b> and <b>Physical Models</b> to help us make sense <br> of increasingly complex data?</h4>
					<br>
					<br>
					<br>
					<ul>
						<li class="fragment grow">Generative Models for Galaxy Image Simulations</li>
						<br>
						<br>
						<br>
						<li class="fragment grow">Differentiable models of the Large Scale Structure</li>
						<br>
						<br>
						<br>
						<li class="fragment grow">Differentiable cosmological computations</li>
						<br>
					</ul>
					<br>
					<br>
					<br>
			</section>

			<section>
				<h2>Deep Generative Models for Galaxy Image Simulations</h2>

				<br>
				<a href="https://arxiv.org/abs/2008.03833"><img src="https://img.shields.io/badge/astro--ph.IM-arXiv%3A2008.03833-B31B1B.svg" class="plain" style="height:25px;" /></a>
				<a href="https://github.com/McWilliamsCenter/galsim_hub"><img src="https://badgen.net/badge/icon/github?icon=github&label" class="plain" style="height:25px;" /></a>
				<a href="https://colab.research.google.com/github/McWilliamsCenter/galsim_hub/blob/master/notebooks/GalsimHubDemo.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" class="plain"
						style="height:25px;" /></a>
				<hr>
				<br>
				<br>
				<div align="left" style="margin-left: 20px;">

					<h3>Work in collaboration with <br>
						Rachel Mandelbaum, Siamak Ravanbakhsh, Chun-Liang Li, Barnabas Poczos, Peter Freeman</h3>
				</div>

				<br>
				<br>

				<div style="float:center; font-size: 25px"><b>Lanusse</b> et al. (2020) <br>
					<!-- Mandelbaum, <b> Lanusse</b>, et al. (2018)<br> -->
					Ravanbakhsh, <b>Lanusse</b>, et al. (2017)
				</div>

			</section>
			<section>
				<section>
					<h3 class="slide-title"> The weak lensing shape measurement problem</h3>
					<div>
						<img class="plain" data-src="assets/great.jpg" />
					</div>

					<div class="block fragment">
						<div class="block-title">
							Shape measurement biases
						</div>
						<div class="block-content">
							$$ < e> = \ (1 + m) \ \gamma \ + \ c $$

								<ul>
									<li class="fragment fade-up"> Can be calibrated on image simulations
									</li>
									<li class="fragment fade-up"> How complex do the simulations need to be?
									</li>
								</ul>
						</div>
					</div>
				</section>

				<!-- <section>
						<h3 class="slide-title"> Image simulations for shear calibration in the HSC survey</h3>
						<div style="float:right; font-size: 20px">Mandelbaum,<b>Lanusse</b>, Leauthaud, Armstrong, et al. (2018)</div>

						<img class="plain" data-src="assets/fig_illustrator_red_2.png" style="height: 450px;"/>

						<div class="block">
						<div class="block-title">
						Hyper Suprime-Cam Subaru Strategic Program
					</div>
					<div class="block-content">
					<ul>
					<li> 1400 sq. deg. in the wide survey down to 26.4 mag in i-band
				</li>
				<li> Essentially a smaller area precursor of LSST
			</li>
			</ul>
			</div>
			</div>
			</section>

			<section>
			<h3 class="slide-title"> Simulation and Calibration strategy</h3>
			<br>

			<img class="plain" data-src="assets/simu.png"/>

			<br>
			<br>
			<div class="block">
			<div class="block-title">
			The GREAT3 approach
			</div>
			<div class="block-content">
			<ul>
			<li> Input galaxies from deep HST/ACS COSMOS images (25.2 imag)
			</li>
			<br>
			<li> Apply a range of PSFs and noise levels sampled from the survey
			</li>
			<br>
			<li>  Measure response of shape measurement to a known shear
			</li>
			</ul>
			</div>
			</div>
			</section> -->

				<!-- <section>

			<h3 class="slide-title"> From simple to complex simulations... Illustration from HSC calibration</h3>
			<div style="float:right; font-size: 20px">Mandelbaum,<b>Lanusse</b>, Leauthaud, Armstrong, et al. (2018)</div>
			<br>

			<div class='container'>
			<div class='col'>
			<img class="plain" data-src="assets/HSC_sims.png"/>
			</div>

			<div class='col'>
			<img class="plain fragment fade-left" data-src="assets/HSC_sims_diff.png"/>
			</div>
			</div>
			</section> -->

				<section>
					<h3 class="slide-title"> Impact of galaxy morphology</h3>
					<div class='container'>
						<div class='col'>
							<img class="plain" data-src="assets/real_gal-inv.png" style="height: 350px;" />
							<br>
							<div style="float:left; font-size: 20px">Mandelbaum, et al. (2013), Mandelbaum, et al. (2014)</div>
						</div>

						<div class='col'>
							<img class="plain fragment fade-up" data-src="assets/great3_calib2-inv.png" style="height: 425px;" />
						</div>
					</div>
					<br>

					<div class="block fragment fade-up">
						<div class="block-title">
							The need for data-driven generative models
						</div>
						<div class="block-content">
							<ul>
								<li> Lack or inadequacy of physical model
								</li>
								<li> Extremely computationally expensive simulations
								</li>
							</ul>
						</div>
					</div>
				</section>
			</section>

			<section class="inverted" data-background="#000">
				<h2>
					Can we learn a model for the signal from the data itself?</h2>
			</section>

			<section>
				<h3 class="slide-title"> The evolution of generative models </h3>

				<br> <br> <br>
				<div class='container'>
					<div class='col'>
						<div style="position:relative; width:500px; height:500px; margin:0 auto;">
							<img class="fragment current-visible plain" data-src="assets/DBN.png" style="position:absolute;top:0;left:0;width:500px;" data-fragment-index="0" />
							<img class="fragment current-visible plain" data-src="assets/vae_faces.jpg" style="position:absolute;top:0;left:0;width:500px;" data-fragment-index="1" />
							<img class="fragment current-visible plain" data-src="assets/gan-samples-1.png" style="position:absolute;top:0;left:0;width:500px;" data-fragment-index="2" />
							<img class="fragment plain" data-src="assets/karras2017.png" style="position:absolute;top:0;left:0;width:500px;" data-fragment-index="3" />
						</div>
					</div>

					<div class='col'>
						<ul>
							<li class="fragment" data-fragment-index="0"> Deep Belief Network <br> (Hinton et al. 2006) </li>
							<br>
							<li class="fragment" data-fragment-index="1"> Variational AutoEncoder <br> (Kingma & Welling 2014) </li>
							<br>
							<li class="fragment" data-fragment-index="2"> Generative Adversarial Network <br> (Goodfellow et al. 2014)</li>
							<br>
							<li class="fragment" data-fragment-index="3"> Wasserstein GAN <br> (Arjovsky et al. 2017) </li>
						</ul>
					</div>
				</div>
				<br> <br> <br>
			</section>

			<!-- <section>
				<h3 class="slide-title"> A visual Turing test </h3>
				<div class="container">
				<div class="col">
				<img data-src="assets/samples_pixel_cnn.png" class="plain" style="height: 500px;" ></img>
				<br>
				<div class="fragment fade-up" data-fragment-index="0"> Fake PixelCNN samples </div>
			</div>
			<div class="col">
			<img data-src="assets/sdss5.png" class="plain"  style="height: 500px;" ></img>
			<br>
			<div class="fragment fade-up" data-fragment-index="0"> Real SDSS </div>
			</div>
			</div>
			</section> -->

			<section>
				<h3 class="slide-title"> Complications specific to astronomical images: spot the differences!</h3>

				<div class="container">
					<div class="col">
						<img data-src="assets/celeba.png" class="plain" style="height: 450px;"></img>
						<br>
						CelebA
					</div>
					<div class="col">
						<img data-src="assets/hsc_images.png" class="plain" style="height: 450px;"></img>
						<br>
						HSC PDR-2 wide
					</div>
				</div>
				<br>
				<div>
					<ul>
						<li class="fragment"> There is <b class="alert">noise</b></li>
						<li class="fragment"> We have a <b class="alert">Point Spread Function</b></li>
					</ul>
				</div>
			</section>

			<section>
				<section>
					<h3 class="slide-title" style="position:absolute;top:0;">A Physicist's approach: let's build a model</h3>
					<br>
					<br>
					<div class="container">
						<div class="col">
							<img class="plain fragment" data-src="assets/rand_z_square.png" style="height: 150px" data-fragment-index="4" />
						</div>
						<div class="col">
							<img class="plain fragment" data-src="assets/cosmos_gal.png" style="width: 200px" data-fragment-index="3" />
						</div>
						<div class="col">
							<img class="plain fragment" data-src="assets/cosmos_gal_psf.png" style="width: 200px" data-fragment-index="2" />
						</div>

						<div class="col">
							<img class="plain fragment" data-src="assets/cosmos_gal_pix.png" style="width: 200px" data-fragment-index="1" />
						</div>

						<div class="col">
							<img class="plain fragment" data-src="assets/cosmos_gal_ground.png" style="width: 200px" data-fragment-index="0" />
						</div>
					</div>

					<div class="container" style="position:relative; width:1000px; height:50px; margin:0 auto;">
						<div class='col fragment' data-fragment-index='4'>
							<font size="10"> $\longrightarrow$ </font> <br> $g_\theta$
						</div>
						<div class='col fragment' data-fragment-index='3'>
							<font size="10"> $\longrightarrow$ </font> <br> PSF
						</div>
						<div class='col fragment' data-fragment-index='2'>
							<font size="10"> $\longrightarrow$ </font> <br> Pixelation
						</div>
						<div class='col fragment' data-fragment-index='1'>
							<font size="10"> $\longrightarrow$ </font> <br> Noise
						</div>
					</div>

					<div class="container">
						<div class="col">
							<div style="position:relative; width:400px; height:300px; margin:0 auto;">
								<img data-src="assets/pgm_0.png" class="plain fragment current-visible " style="position:absolute;top:0;left:0;height:300px;" data-fragment-index="0" />
								<img data-src="assets/pgm_1.png" class="plain fragment current-visible " style="position:absolute;top:0;left:0;height:300px;" data-fragment-index="1" />
								<img data-src="assets/pgm_1.png" class="plain fragment current-visible " style="position:absolute;top:0;left:0;height:350px;" data-fragment-index="2" />
								<img data-src="assets/pgm_2.png" class="plain fragment current-visible " style="position:absolute;top:0;left:0;height:350px;" data-fragment-index="3" />
								<img data-src="assets/pgm_3.png" class="plain fragment " style="position:absolute;top:0;left:0;height:300px;" data-fragment-index="4" />
							</div>
						</div>
						<div class=" col">
							<div class="block fragment" data-fragment-index="0">
								<div class="block-title">
									Probabilistic model
								</div>
								<div class="block-content">
									<div style="position:relative; width:400px; height:100px; margin:0 auto;">
										<div class="plain fragment current-visible " style="position:absolute;top:0;left:0;width:400px;" data-fragment-index="0"> $$ x \sim ? $$ </div>
										<div class="plain fragment current-visible " style="position:absolute;top:0;left:0;width:400px;" data-fragment-index="1"> $$ x \sim \mathcal{N}(z, \Sigma) \quad z \sim ? $$<br>latent $z$ is a denoised galaxy image</div>
										<div class="plain fragment current-visible " style="position:absolute;top:0;left:0;width:400px;" data-fragment-index="2"> $$ x \sim \mathcal{N}( \mathbf{P} z, \Sigma) \quad z \sim ?$$<br>latent $z$ is a super-resolved and denoised
											galaxy image</div>
										<div class="plain fragment current-visible " style="position:absolute;top:0;left:0;width:400px;" data-fragment-index="3"> $$ x \sim \mathcal{N}( \mathbf{P} (\Pi \ast z), \Sigma) \quad z \sim ? $$<br>latent $z$ is a deconvolved,
											super-resolved, and denoised galaxy image </div>
										<div class="plain fragment " style="position:absolute;top:0;left:0;width:400px;" data-fragment-index="4"> $$ x \sim \mathcal{N}( \mathbf{P} (\Pi \ast g_\theta(z)), \Sigma) \quad z \sim \mathcal{N}(0, \mathbf{I}) $$ <br>latent $z$
											is a Gaussian sample<br> <b class="alert"> $\theta$ are parameters of the model</b> </div>
									</div>
									<br>
									<br>
									<br>
								</div>
							</div>
						</div>
					</div>
					<div class="fragment"> $\Longrightarrow$ <b class="alert"> Decouples the morphology model from the observing conditions</b>.</div>
				</section>

				<section>
					<h3 class="slide-title">How to train your <s>dragon</s> model</h3>
					<div class="container">
						<div class="col">
							<img data-src="assets/pgm.png" class="plain" style="height: 300px;"></img>
						</div>
						<div class="col">
							<ul>
								<li> Training the generative amounts to finding $\theta_\star$ that
									<b>maximizes the marginal likelihood</b> of the model:
									$$p_\theta(x | \Sigma, \Pi) = \int \mathcal{N}( \Pi \ast g_\theta(z), \Sigma) \ p(z) \ dz$$
									<div> $\Longrightarrow$ This is <b class="alert">generally intractable</b></div>
								</li>
								<br>
								<li class="fragment fade-up"> Efficient training of parameter $\theta$ is made possible by <b class="alert">Amortized Variational Inference</b>.
								</li>
							</ul>
						</div>
					</div>

					<div class="block fragment fade-up">
						<div class="block-title">
							Auto-Encoding Variational Bayes (Kingma & Welling, 2014)
						</div>
						<div class="block-content">
							<ul>
								<li class="fragment fade-up"> We introduce a <b>parametric distribution</b> $q_\phi(z | x, \Pi, \Sigma)$ which aims to model the
									posterior $p_{\theta}(z | x, \Pi, \Sigma)$.
								</li>
								<br>
								<li class="fragment fade-up"> Working out the KL divergence between these two distributions leads to:

									$$\log p_\theta(x | \Sigma, \Pi) \quad \geq \quad - \mathbb{D}_{KL}\left( q_\phi(z | x, \Sigma, \Pi) \parallel p(z) \right) \quad + \quad \mathbb{E}_{z \sim q_{\phi}(. | x, \Sigma, \Pi)} \left[ \log p_\theta(x | z, \Sigma, \Pi)
									\right]$$

									$\Longrightarrow$ This is the <b>Evidence Lower-Bound</b>, which is differentiable with respect to $\theta$ and $\phi$.
								</li>
							</ul>
						</div>
					</div>

				</section>
				<!-- <section>
					<h3 class="slide-title">The famous Variational Auto-Encoder</h3>
					<img data-src="assets/vae.png" class="plain" style="height: 450px;"> </img>
					<br>
					<br>
					$$\log p_\theta(x| \Sigma, \Pi ) \geq - \underbrace{\mathbb{D}_{KL}\left( q_\phi(z | x, \Sigma, \Pi) \parallel p(z) \right)}_{\mbox{code regularization}} + \underbrace{\mathbb{E}_{z \sim q_{\phi}(. | x, \Sigma, \Pi)} \left[ \log p_\theta(x
					| z, \Sigma, \Pi) \right]}_{\mbox{reconstruction error}} $$
				</section> -->


				<!-- <section>
				<h3 class="slide-title"> Conditional sampling in VAE latent space</h3>

				<div class="container">
				<div class="col">
				<img data-src="assets/conditional_flow.png" class="plain" ></img>
			</div>
			<div class="col">

			<ul>
			<li> We build a latent space model $p_\varphi(z)$ using a Masked Autoregressive Flow (MAF) (Papamakarios, et al. 2017)
			</li>
			<br>
			<li class="fragment"> While we are learning to sample from the latent space, we can also <b class="alert"> learn to sample conditionaly</b>:
			$$  p_\varphi(z | y) $$
			</li>
			<br>

			<li class="fragment"> Here we learn to sample images conditioned on:
			<ul>
			<li> Size: half-light radius $r$
			</li>
			<li> Brightness: I band magnitude $mag\_auto$
			</li>
			<li> Redshift: COSMOS photometric redshift $zphot$
			</li>
			</ul>
			</li>
			</ul>
			</div>
			</div>
			</section> -->
			</section>

			<section>
				<h3 class="slide-title"> Illustration on HST/ACS COSMOS images</h3>
				<div class="container">
					<div class="col">
						<img data-src="assets/Figure_autoencode.png" class="plain"></img>
						<br>
						<b>Fitting observations</b> with VAE and Bulge+Disk parametric model.
					</div>
					<div class="col">
						<ul>
							<li>Training set: <b>GalSim COSMOS HST/ACS postage stamps</b>
								<br>
								<ul>
									<li> 80,000 deblended galaxies from I < 25.2 sample </li>
									<li> Drawn on 128x128 stamps at 0.03 arcsec resolution
									</li>
									<li> Each stamp comes with:
										<ul>
											<li>PSF</li>
											<li>Noise power spectrum</li>
											<li>Bulge+Disk parametric fit</li>
										</ul>
									</li>
								</ul>
							</li>
							<br>
							<li> Auto-Encoder model:
								<ul>
									<li> Deep residual autoencoder:<br> 7 stages of 2 resnet blocs each
									</li>
									<li> Dense bottleneck of size 16.
									</li>
									<li> Outputs positive, noiseless, deconvolved, galaxy surface brightness.
									</li>
								</ul>
							</li>
							<br>
							<li class="fragment"><b class="alert">Generative models are conditioned on:</b><br>
								<b>mag_auto, flux_radius, zphot</b>
							</li>
						</ul>
					</div>
				</div>
			</section>

			<section>

				<section>
					<h3 class="slide-title"> Flow-VAE samples</h3>
					<br>
					<br>
					<img class="current-visible plain" data-src="assets/lanusse2020_figure1.png" />
				</section>

				<section>
					<h3 class="slide-title">Second order moments</h3>
					<br>

					<br>
					<img class="current-visible plain" data-src="assets/lanusse2020_fig6a.png" style="width:850px;" /><br>
					<!-- <img class="current-visible plain" data-src="assets/lanusse2020_fig6b.png" style="width:550px;" /> -->
					<br>
					<br>
				</section>

				<section>
					<h3 class="slide-title"> Testing conditional sampling</h3>
					<img data-src="assets/lanusse2020_figure7.png" style="width:1000px;" class="plain"></img>
					<div class="fragment">$\Longrightarrow$ We can successfully condition galaxy generation.</div>
				</section>

				<section>
					<h3 class="slide-title"> Testing galaxy morphologies </h3>
					<br>
					<br>
					<img data-src="assets/gini_m20.png" class="plain"></img>
					<br>
					<br>
				</section>
			</section>

			<section>
				<section>
					<h3 class="slide-title">Going one step further: generative models as data-driven priors</h3>
					<br>
					$\boxed{y = \mathbf{A}x + n}$
					<br>
					<br>
					$\mathbf{A}$ is known and encodes our physical understanding of the problem.
					<span class="fragment"><br>$\Longrightarrow$ When non-invertible or ill-conditioned, the inverse problem is ill-posed with no unique solution $x$</span>
					<br>
					<br>
					<div class="container fragment fade-up">
						<div class="col">
							$y$<br>
							<img class="plain" data-src="assets/cosmos_gal_ground.png" style="width: 250px" />
							<br><b class="alert">Simulated Rubin Observatory</b>
						</div>

						<div class="col ">
							$$ = \qquad \Pi \qquad \ast $$
						</div>

						<div class="col">
							$x$<br>
							<img class="plain" data-src="assets/cosmos_gal.png" style="width: 250px" />
							<br><b class="alert">Hubble Space Telescope</b>
						</div>

						<div class="col ">
							$$+ \qquad n$$
						</div>
					</div>

				</section>

				<section>
					<h3 class="slide-title">Bayesian Inference a.k.a. Uncertainty Quantification</h3>
					<div class="container">
						<div class="col">
							<img data-src="assets/pgm.png" class="plain" style="height: 250px;"></img>
						</div>
						<div class="col">
							The Bayesian view of the problem:
							$$ p(z | x ) \propto p_\theta(x | z, \Sigma, \mathbf{\Pi}) p(z)$$
							where:
							<br>
							<ul>
								<li>$p( z | x )$ is the <b class="alert">posterior</b></li>
								<li>$p( x | z )$ is the data likelihood, <b class="alert">contains the physics</b></li>
								<li>$p( z )$ is the <b>prior</b> </li>
							</ul>
						</div>
					</div>

					<div class="container">
						<div class="col">
							<div style="position:relative; width:200px; height:200px; margin:0 auto;">
								<img class="plain fragment current-visible" data-src="assets/cosmos_gal_ground.png" style="position:absolute;top:0;left:0;width:200px;" data-fragment-index="0" />
								<img class="plain fragment" data-src="assets/cosmos_gal.png" style="position:absolute;top:0;left:0;width:200px;" data-fragment-index="1" />
							</div>
							<div class="container" style="position:relative; width:200px; height:50px; margin:0 auto;">
								<div class='col fragment current-visible' data-fragment-index='0' style="position:absolute;top:0;left:0;width:200px;"> Data<br> $x_n$</div>
								<div class='col fragment' data-fragment-index='1' style="position:absolute;top:0;left:0;width:200px;"> Truth<br> $x_0$ </div>
							</div>
							<br>
						</div>

						<div class="col fragment" data-fragment-index='0'>
							<div style="position:relative; width:200px; height:200px; margin:0 auto;">
								<div><video data-autoplay data-loop data-src="assets/rec_samples.mp4" type="video/mp4" style="height: 200px;" />
								</div>
							</div>
							<div>Posterior samples<br> $g_\theta(z)$</div>
						</div>

						<div class="col">
							<div style="position:relative; width:200px; height:200px; margin:0 auto;">
								<div><video class="fragment current-visible" data-autoplay data-loop data-src="assets/rec_lsst.mp4" type="video/mp4" style="position:absolute;top:0;left:0;width:200px;" data-fragment-index="0" /></div>
								<img class="plain fragment " data-src="assets/rec_median.png" style="position:absolute;top:0;left:0;width:200px;" data-fragment-index="1" />
							</div>

							<div class="container" style="position:relative; width:200px; height:50px; margin:0 auto;">
								<div class='col fragment current-visible' data-fragment-index='0' style="position:absolute;top:0;left:0;width:200px;"> <br> $\mathbf{P} (\Pi \ast g_\theta(z))$</div>
								<div class='col fragment' data-fragment-index='1' style="position:absolute;top:0;left:0;width:200px;"> Median </div>
							</div>
						</div>

						<div class="col">
							<div style="position:relative; width:200px; height:200px; margin:0 auto;">
								<div><video class="fragment current-visible" data-autoplay data-loop data-src="assets/res_lsst.mp4" type="video/mp4" style="position:absolute;top:0;left:0;width:200px;" data-fragment-index="0" /></div>
								<img class="plain fragment " data-src="assets/rec_std.png" style="position:absolute;top:0;left:0;width:200px;" data-fragment-index="1" />
							</div>

							<div class="container" style="position:relative; width:200px; height:50px; margin:0 auto;">
								<div class='col fragment current-visible' data-fragment-index='0' style="position:absolute;top:0;left:0;width:200px;"> Data residuals <br> $x_n - \mathbf{P} (\Pi \ast g_\theta(z))$</div>
								<div class='col fragment' data-fragment-index='1' style="position:absolute;top:0;left:0;width:200px;"> Standard Deviation </div>
							</div>
						</div>
					</div>
					<div class="fragment"> $\Longrightarrow$ <b class="alert">Uncertainties are fully captured by the posterior</b>.</div>
				</section>
			</section>


			<section>
				<h3 class="slide-title">Examples of applications of generative models</h3>
				<br>
				<div class="container">
					<div class="col">
						<ul>
							<li><em>Hybrid Physical-Deep Learning Model for Astronomical Inverse Problems</em><br> <b> F. Lanusse</b>, P. Melchior, F. Moolekamp<br>
								<a href="https://arxiv.org/abs/1912.03980"><img src="https://img.shields.io/badge/astro--ph.IM-arXiv%3A1912.03980-B31B1B.svg" class="plain" style="height:25px;" /></a>
								<a href="https://www.youtube.com/watch?v=oWOU3qNHoL0"><img src="https://img.shields.io/badge/-youtube-red?logo=youtube&labelColor=grey" class="plain" style="height:25px;" /></a>
							</li>
						</ul>
						<br> <br>
						$\mathcal{L} = \frac{1}{2} \parallel \mathbf{\Sigma}^{-1/2} (\ Y - P \ast A S \ ) \parallel_2^2 - \sum_{i=1}^K \log p_{\theta}(S_i)$
						<br> <br>
						<img class=" plain" data-src="assets/scarlet_hsc.png" />
						<br> <br>

					</div>
					<div class="col fragment">
						<ul>
							<li><em>Denoising Score-Matching for Uncertainty Quantification in Inverse Problems</em><br> Z. Ramzi, B. Remy, <b>F. Lanusse</b>, P. Ciuciu, J.L. Starck<br>
							</li>
						</ul>
						<img class="plain" data-src="assets/knee.gif" />

					</div>
				</div>
			</section>

			<section>
				<h3 class="slide-title"> Takeaway message</h3>
				<br>
				<ul>
					<li class="fragment"> We have <b class="alert">combined physical and deep learning components</b> to model
						observed noisy and PSF-convolved galaxy images. <br>
						$\Longrightarrow$ This framework can handle multi-band, multi-resolution, multi-instrument data.
					</li>

					<br>

					<!-- <li class="fragment"> We are overcoming the limitations of standard VAEs with an additional latent space model.
						<br>$\Longrightarrow$ Can produce sharp and meaningful images.
					</li> -->

					<br>

					<li class="fragment"> Once trained, generative models can be used as <b class="alert">data-driven priors</b> for various inverse problems: denoising, deblending, deconvoluion, etc....
						<br> $\Longrightarrow$ This Bayesian framework allows for robust uncertainty quantification.
					</li>

					<br>
				</ul>
				<br>
				<br>

				<div class="block fragment fade-up">
					<div class="block-title">
						<b>GalSim Hub</b>
					</div>
					<div class="block-content">

						<br>

						<div class="container">
							<div class="col">
								<img data-src="assets/TF_FullColor_Horizontal.png" class="plain"></img>
							</div>

							<div class="col">

								<ul>

									<li> Framework for sampling from deep generative models
										directly from within GalSim.
									</li>

									<br>

									<li> Go check out the beta version: <a href="https://github.com/McWilliamsCenter/galsim_hub">https://github.com/McWilliamsCenter/galsim_hub</a>
									</li>

								</ul>

							</div>
						</div>

					</div>
				</div>

			</section>

			<section>
				<h2>Differentiable models of the Large-Scale Structure</h2>

				<a href="https://github.com/modichirag/flowpm"><img src="https://badgen.net/badge/icon/github?icon=github&label" class="plain" style="height:25px;" /></a>
				<a href="https://colab.research.google.com/github/modichirag/flowpm/blob/master/notebooks/flowpm_blog.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab" class="plain"
						style="height:25px;" /></a>
				<a href="https://blog.tensorflow.org/2020/03/simulating-universe-in-tensorflow.html"><img src="https://img.shields.io/badge/blog-TensorFlow-orange?color=FF6F00" class="plain" style="height:25px;" /> </a>
				<hr>
				<div class="container">
					<div class="col">
						<div align="left" style="margin-left: 20px;">
							<h3>Work in collaboration with <br>
								Chirag Modi, Uroš Seljak</h3>

							<br> <br>

							<div style="float:center; font-size: 25px">Modi, <b>Lanusse</b>, Seljak, et al., in prep <br>
								Modi, et al. (2018)
							</div>
						</div>
					</div>
					<div class="col">
						<img src="assets/flowpm.gif" />
					</div>
				</div>
				<br>


			</section>

			<section>
				<h3 class='slide-title'> traditional cosmological inference </h3>
				<div class='container'>
					<div class='col'>
						<div style="position:relative; width:480px; height:30px; margin:0 auto;">
							<div class="fragment current-visible" style="position:absolute;top:0;" data-fragment-index="1">HSC cosmic shear power spectrum</div>
							<div class="fragment" style="position:absolute;top:0;" data-fragment-index="2">HSC Y1 constraints on $(S_8, \Omega_m)$</div>
						</div>
						<div style="position:relative; width:480px; height:300px; margin:0 auto;">
							<div class="fragment current-visible" style="position:absolute;top:0;left:0;" data-fragment-index="0">
								<img class="plain" data-src="assets/alonso_g1.png" />
								<img class="plain" data-src="assets/alonso_g2.png" />
							</div>
							<img class="fragment current-visible plain" data-src="assets/hsc_correlation_function.png" style="position:absolute;top:0;left:0;" data-fragment-index="1" />
							<img class="fragment  plain" data-src="assets/hsc_constraints.png" style="position:absolute;top:0;left:0;" data-fragment-index="2" />
						</div>
						<div class="fragment" data-fragment-index="1" style="float:right; font-size: 20px">(Hikage,..., <b>Lanusse</b>, et al. 2018)</div>
					</div>

					<div class='col'>
						<ul>
							<li class="fragment" data-fragment-index="0"> Measure the ellipticity $\epsilon = \epsilon_i + \gamma$ of all galaxies<br>
								$\Longrightarrow$ Noisy tracer of the weak lensing shear $\gamma$ </li>
							<br>
							<li class="fragment" data-fragment-index="1"> Compute <b class="alert">summary statistics</b> based on 2pt functions, <br>e.g. the <b>power spectrum</b> </li>
							<br>
							<li class="fragment" data-fragment-index="2"> Run an MCMC to recover a posterior on model parameters, using an <b class="alert">analytic likelihood</b>
								$$ p(\theta | x ) \propto \underbrace{p(x | \theta)}_{\mathrm{likelihood}} \ \underbrace{p(\theta)}_{\mathrm{prior}}$$
							</li>
						</ul>
					</div>
				</div>

				<div class="block fragment">
					<div class="block-title">
						Main limitation: the need for an explicit likelihood
					</div>
					<div class="block-content">
						We can only compute the likelihood for <b>simple summary statistics</b> and on <b>large scales</b>
						<br>
						<br>
						<div class="fragment"> $\Longrightarrow$ We are dismissing most of the information! </div>
					</div>
				</div>
			</section>

			<section>
				<h3 class='slide-title'>A different road: forward modeling</h3>

				<div class='container'>
					<div class='col'>
						<ul>
							<li> Instead of trying to analytically evaluate the likelihood,
								let us build a forward model of the observables.</li>
							<br>
							<li class="fragment" data-fragment-index="1"> Each component of the model is now tractable, but at the
								cost of a <b>large number of latent variables</b>.
							</li>
						</ul>

						<br>
						<div class="fragment">
							$\Longrightarrow$ How to peform efficient inference in this large number of dimensions?
						</div>
						<br>
						<br>
						<ul class="fragment"> A non-exhaustive list of methods:
							<li> Hamiltonian Monte-Carlo
							</li>
							<li> Variational Inference
							</li>
							<li> MAP+Laplace
							</li>
							<li> Gold Mining
							</li>
							<li> Dimensionality reduction by Fisher-Information Maximization
							</li>
						</ul>
						<br>
						<br>
						<div class="fragment">
							What do they all have in common?<br>
							-> They require fast, accurate, <b class="alert">differentiable</b> forward simulations
						</div>
					</div>

					<div class='col'>

						<div style="position:relative; width:600px; height:600px; margin:0 auto;">
							<img class="fragment current-visible plain" data-src="assets/forward_model.png" style="position:absolute;top:0;left:0;width:600px;" data-fragment-index="0" />
							<img class="fragment plain" data-src="assets/pgm_lensing.png" style="position:absolute;top:0;left:0;width:500px;" data-fragment-index="1" />
							<div class="fragment" data-fragment-index="1" style="float:right; font-size: 20px">(Schneider et al. 2015)</div>
						</div>
					</div>
				</div>
			</section>

			<section class="inverted" data-background="#000">
				<h2>How do we simulate the Universe in a fast and differentiable way?</h2>
			</section>

			<section>
				<h3 class='slide-title'>Forward Models in Cosmology</h3>
				<div class="container">
					<div class='col'>
						<img data-src="assets/fieldinit.png" class="plain" style="height:300px;" />
						<b class="alert"> Linear Field </b>
					</div>
					<div class='col fragment' data-fragment-index='2'>
						<img data-src="assets/fieldfin.png" class="plain " style="height:300px;" />
						<b class="alert"> Final Dark Matter </b>
					</div>
					<hr style="width: 1px; height: 400px; background: white; border: none;" />
					<div class='col fragment' data-fragment-index='3'>
						<img data-src="assets/fieldhalo.png" class="plain " style="height:300px;" />
						<b class="alert"> Dark Matter Halos </b>
					</div>
					<div class='col fragment' data-fragment-index='4'>
						<img data-src="assets/fieldgal.png" class="plain " style="height:300px;" />
						<b class="alert"> Galaxies </b>
					</div>
				</div>
				<div class="container" style="position:relative; width:1000px; height:50px; margin:0 auto;">
					<div class='col fragment' data-fragment-index='2'>
						<font size="10"> $\longrightarrow$ </font> <br>
						<div class="fragment grow" data-fragment-index='5'>N-body simulations </div>
					</div>
					<div class='col fragment' data-fragment-index='3'>
						<font size="10"> $\longrightarrow$ </font> <br> Group Finding <br> algorithms
					</div>
					<div class='col fragment' data-fragment-index='4'>
						<font size="10"> $\longrightarrow$ </font> <br> Semi-analytic &amp <br> distribution models
					</div>
					<!-- 		<div class='fragment' data-fragment-index='2'> N-body simulations <div> -->
					<!-- <div class='fragment' data-fragment-index='3'> Group Finding algorithms <div> -->
					<!-- <div class='fragment' data-fragment-index='4'> Semi-analytic models <div> -->
				</div>
			</section>

			<section>
				<h3 class='slide-title'>You can try to learn the simulation...</h3>
				<div style="float:right; font-size: 25px">Learning particle displacement with a UNet. S. He, et al. (2019)</div><br><br>

				<img data-src="assets/Model-Comparison.jpg" style="height:400px;" />

				<div class="block fragment">
					<div class="block-title">
						The issue with using deep learning as a <i>black-box</i>
					</div>
					<div class="block-content">
						<ul>
							<li> No guarantees to work outside of training regime.
							</li>
							<li> No guarantees to capture dependence on cosmology accurately.
							</li>
						</ul>
					</div>
				</div>
			</section>

			<section>
				<h3 class='slide-title'>the Fast Particle-Mesh scheme for N-body simulations</h3>
				<b>The idea</b>: approximate gravitational forces by estimating densities on a grid.

				<div class='container'>
					<div class='col'>
						<ul>
							<li>The numerical scheme:
								<br>
								<br>
								<ul>
									<li class="fragment" data-fragment-index="1"> Estimate the density of particles on a mesh<br>
										=> compute gravitational forces by FFT
									</li>

									<br>

									<li class="fragment" data-fragment-index="2"> Interpolate forces at particle positions
									</li>

									<br>

									<li class="fragment" data-fragment-index="3"> Update particle velocity and positions, and iterate
									</li>
								</ul>
							</li>
							<br>

							<li class='fragment'> Fast and simple, at the cost of approximating short range interactions.
							</li>

						</ul>
					</div>

					<div class='col'>

						<div style="position:relative; width:550px; height:550px; margin:0 auto;">
							<img class="fragment current-visible plain" data-src="assets/particle_positions_0.png" style="position:absolute;top:0;left:0;" data-fragment-index="0" />
							<img class="fragment current-visible plain" data-src="assets/particle_density_0.png" style="position:absolute;top:0;left:0;" data-fragment-index="1" />
							<img class="fragment current-visible plain" data-src="assets/particle_positions_0.png" style="position:absolute;top:0;left:0;" data-fragment-index="2" />
							<img class="fragment  plain" data-src="assets/particle_positions_1.png" style="position:absolute;top:0;left:0;" data-fragment-index="3" />

						</div>

					</div>
				</div>

				<div class="fragment"> $\Longrightarrow$ Only a series of FFTs and interpolations.</div>
			</section>

			<section>
				<h3 class='slide-title'>introducing FlowPM: Particle-Mesh Simulations in TensorFlow</h3>

				<div class='container'>
					<div class='col'>
						<img data-src="assets/github.png" class="plain" style="height:70px" />
						<div> <a href="https://github.com/modichirag/flowpm">https://github.com/modichirag/flowpm</a>
						</div>
						<pre class="python"><code data-trim data-noescape>
										import tensorflow as tf
										import flowpm
										# Defines integration steps
										stages = np.linspace(0.1, 1.0, 10, endpoint=True)

										initial_conds = flowpm.linear_field(32,        # size of the cube
										100,       # Physical size
										ipklin,    # Initial powerspectrum
										batch_size=16)

										# Sample particles and displace them by LPT
										state = flowpm.lpt_init(initial_conds, a0=0.1)

										# Evolve particles down to z=0
										final_state = flowpm.nbody(state, stages, 32)

										# Retrieve final density field
										final_field = flowpm.cic_paint(tf.zeros_like(initial_conditions),
										final_state[0])

										with tf.Session() as sess:
										sim = sess.run(final_field)
									</code></pre>
						<ul>
							<li> Seamless interfacing with deep learning components
							</li>
							<li> <b class="alert">Mesh TensorFlow</b> implementation for distribution on supercomputers
							</li>
						</ul>
					</div>

					<div class='col'>
						<div class="fig-container" data-file="flowpm_16.html" data-style="height: 550px;"></div>
						<img data-src="assets/TF_FullColor_Horizontal.png" class='plain' style="height: 70px;" />
					</div>
				</div>

				<!--We can have a link to the project, an showcase an iframe with the
							small simulation running on the right-->
			</section>


			<section>
				<section>
					<h3 class='slide-title'>Example use-case: reconstructing initial conditions by MAP optimization</h3>
					<img data-src="assets/evolvingLSS.jpg" class="plain" /><br>
					<div class="fragment">Going back to simpler times...</div>

					<div class="fragment">
						$$\arg\max_z \ \log p(x_{dm} = f(z)) \ + \ p(z) $$
						where:<br>
						<ul>
							<li> $f$ is <b>FlowPM </b>
							</li>
							<li> $z$ are the initial conditions (early universe)
							</li>
							<li> $x_{dm}$ is the present day dark matter distribution
							</li>
						</ul>
					</div>
				</section>

				<section>
					<h3 class="slide-title"> MAP optimization in action</h3>
					$$\arg\max_z \ \log p(x_{dm} = f(z)) \ + \ p(z) $$
					<div style="float:right; font-size: 16px">credit: <a href="https://github.com/modichirag">C. Modi</a></div>
					<br>
					<div class="container">
						<div class="col fragment fade-up">
							<img data-src="assets/init_field.png" style='height:250px;' />
							<br> True initial conditions <br> $z_0$
						</div>

						<div class="col">
							<img data-src="assets/reconim_init.gif" style='height:250px;' />
							<br> Reconstructed initial conditions $z$
						</div>

						<div class="col">
							<img data-src="assets/reconim_fin.gif" style='height:250px;' />
							<br> Reconstructed dark matter distribution $x = f(z)$
						</div>

						<div class="col">
							<img data-src="assets/fin_field.png" style='height:250px;' />
							<br> Data <br> $x_{DM} = f(z_0)$
						</div>
					</div>
					<br>
					<br>

					<div class="fragment">
						Check out this blogpost for more details <br> <a href=https://blog.tensorflow.org/2020/03/simulating-universe-in-tensorflow.html>
							https://blog.tensorflow.org/2020/03/simulating-universe-in-tensorflow.html</a>
					</div>
				</section>
			</section>



			<section>

				<section>
					<h3 class='slide-title'>Forward Models in Cosmology</h3>
					<div class="container">
						<div class='col'>
							<img data-src="assets/fieldinit.png" class="plain" style="height:300px;" />
							<b class="alert"> Linear Field </b>
						</div>
						<div class='col '>
							<img data-src="assets/fieldfin.png" class="plain " style="height:300px;" />
							<b class="alert"> Final Dark Matter </b>
						</div>
						<hr style="width: 1px; height: 400px; background: white; border: none;" />
						<div class='col fragment' data-fragment-index='3'>
							<img data-src="assets/fieldhalo.png" class="plain " style="height:300px;" />
							<b class="alert"> Dark Matter Halos </b>
						</div>
						<div class='col fragment' data-fragment-index='4'>
							<img data-src="assets/fieldgal.png" class="plain " style="height:300px;" />
							<b class="alert"> Galaxies </b>
						</div>
					</div>
					<div class="container" style="position:relative; width:1000px; height:50px; margin:0 auto;">
						<div class='col'>
							<font size="10"> $\longrightarrow$ </font> <br> N-body simulations <br> <b class="alert">FlowPM</b>
						</div>
						<div class='col fragment' data-fragment-index='3'>
							<font size="10"> $\longrightarrow$ </font> <br> Group Finding <br> algorithms
						</div>
						<div class='col fragment' data-fragment-index='4'>
							<font size="10"> $\longrightarrow$ </font> <br> Semi-analytic &amp <br> distribution models
						</div>
						<!-- 		<div class='fragment' data-fragment-index='2'> N-body simulations <div> -->
						<!-- <div class='fragment' data-fragment-index='3'> Group Finding algorithms <div> -->
						<!-- <div class='fragment' data-fragment-index='4'> Semi-analytic models <div> -->
					</div>
				</section>

				<section>
					<h3 class='slide-title'> Example of Extending Dark Matter Simulations with Deep Learning</h3>

					<div style="position:relative; width:1000px; height:290px; margin:0 auto;">
						<img style="position:absolute;top:0;left:50px;" data-src="assets/recontruth.png" height="300" />
					</div>
					<div style="position:relative; width:1000px; height:290px; margin:0 auto;">
						<div class="fragment " data-fragment-index="0" style="position:absolute;top:10px;left:600px;font-size:200%"> $\longrightarrow$ </div>
						<img class="fragment plain" data-fragment-index="0" style="position:absolute;top:50px;left:500px;" data-src="assets/fnn.png" height="150" />
						<img class="fragment " data-fragment-index="1" style="position:absolute;top:0;left:50px;" data-src="assets/reconinit.png" height="300" />
						<img class="fragment " data-fragment-index="2" style="position:absolute;top:0;left:50px;" data-src="assets/reconrecon.png" height="300" />
					</div>
					<div class="fragment" data-fragment-index="1" style="position:relative; float:right; top: -30px; left:-50px; font-size: 20px; margin:0 auto">Modi et al. 2018</div>

				</section>
			</section>

			<section>
				<h3 class='slide-title'>The practical challenge for inference at scale</h3>

				<br>
				<br>

				<div class="container">
					<div class="col">
						<ul>
							<li> Simulations of scientifically interesting sizes <b class="alert">do not fit on a single GPU RAM</b> <br>
								e.g. $128^3$ operational, need $1024^3$ for survey volumes <br>
								$\Longrightarrow$ We need a <b>distributed Machine Learning Framework</b><br>
							</li>
							<br>
							<li class="fragment" data-fragment-index="1">Most common form of distribution is <b>data-parallelism</b>
								$\Longrightarrow$ Reached Exascale on scientific deep learning applications
							</li>
							<br>
							<li class="fragment"> What we need is <b>model-parallelism</b> on HPC environments
							</li>
						</ul>
					</div>

					<div class="col">
						<img data-src="assets/summit.png" class="fragment" data-fragment-index="1">
					</div>
				</div>

				<br>
				<br>

				<div class="fragment">
					$\Longrightarrow$ We have investigatded the <b class="alert">Mesh TensorFlow</b> framework on the NERSC Cori machine and Google TPUs</b>.
				</div>
			</section>

			<section>
				<h3 class='slide-title'>Mesh TensorFlow in a few words</h3>
				<ul>
					<li> Redefines the TensorFlow API, in terms of <b class="alert">abstract logical tensors</b>
						with actual <b class="alert">memory instantiation on multiple devices</b>.
					</li>
				</ul>

				<div class="" data-fragment-index="3" style="float:right; font-size: 20px">(Gholami et al. 2018)</div><br>
				<br>
				<img class="" data-fragment-index="3" data-src="assets/mesh_tensorflow.png" style="height:300px;" /><br>

				<div class="block fragment">
					<div class="block-title">
						Our assessment so far
					</div>
					<div class="block-content">
						<ul>
							<li> Provides an easy framework to write down distributed differentiable simulations
								and large scale Machine Learning tasks
							</li>

							<li class="fragment"> The Mesh TensorFlow project is still young, limited in scope, and with limited GPU parallelization support<br>
								<b class="alert"> $\Longrightarrow$ we need help from the Physics community to develop it for our needs!</b>
							</li>

						</ul>
					</div>
				</div>
			</section>

			<section>
				<h3 class="slide-title"> Takeaway message</h3>

				<ul>
					<li class="fragment"> We are <b class="alert">combining physical and deep learning components</b> to model
						the Large-Scale Structure in a <b>fast and differentiable way</b>. <br>
						$\Longrightarrow$ This is <b>a necessary backbone</b> for large scale simulation-based inference.
					</li>
					<br>
					<li class="fragment"> We are demonstrating that large-scale simulations can be
						implemented in distributed autodiff frameworks.
						<br>$\Longrightarrow$ We hope that this will one day become the norm.
					</li>
					<!-- <br>
					<li class="fragment"> Our community has unique needs and limited resources,
					we will all gain by working collaboratively !
				</li> -->
				</ul>

				<br>
				<br>


				<div class="fragment">
					Check out this blogpost to learn more <br> <a href=https://blog.tensorflow.org/2020/03/simulating-universe-in-tensorflow.html>
						https://blog.tensorflow.org/2020/03/simulating-universe-in-tensorflow.html</a>

					<div class="container">
						<div class="col">
							<img data-src="assets/init_field.png" style='height:250px;' />
							<br> True initial conditions <br> $z_0$
						</div>

						<div class="col">
							<img data-src="assets/reconim_init.gif" style='height:250px;' />
							<br> Reconstructed initial conditions $z$
						</div>

						<div class="col">
							<img data-src="assets/reconim_fin.gif" style='height:250px;' />
							<br> Reconstructed dark matter distribution $x = f(z)$
						</div>

						<div class="col">
							<img data-src="assets/fin_field.png" style='height:250px;' />
							<br> Data <br> $x_{DM} = f(z_0)$
						</div>
					</div>
				</div>
			</section>


			<section>
				<h2>jax-cosmo: End-to-end automatically differentiable and GPU accelerated cosmology library</h2>
				<br>
				<a href="https://gitter.im/DifferentiableUniverseInitiative/jax_cosmo?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge"><img src="https://badges.gitter.im/DifferentiableUniverseInitiative/jax_cosmo.svg" class="plain"
						style="height:25px;" /></a>
				<a href="https://github.com/DifferentiableUniverseInitiative/jax_cosmo"><img src="https://badgen.net/badge/icon/github?icon=github&label" class="plain" style="height:25px;" /></a>
				<a href="https://colab.research.google.com/github/DifferentiableUniverseInitiative/jax_cosmo/blob/master/docs/notebooks/jax-cosmo-intro.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg"
						alt="Open In Colab" class="plain" style="height:25px;" /></a>
				<hr>
				<br>
				<div class="container">
					<div class="col">
						<div align="left" style="margin-left: 20px;">
							<h3>Collaborative project, join us :-)</h3>
						</div>
					</div>
					<div>
						<img data-src="assets/jax_cosmo_people.png" />
					</div>
				</div>
				<br>
			</section>

			<section>
				<h3 class="slide-title">A motivating example: Fisher forecasts</h3>

				<div class="container">
					<div class="col">

						<ul>

							<li class="fragment"> Fisher matrices are notoriously unstable<br>
								$\Longrightarrow$ they rely on evaluating gradients by finite differences.
							</li>
							<br>
							<br>
							<li class="fragment"> They do not scale well to large number of parameters.
							</li>
							<br>
							<br>
							<li class="fragment"> The main reason for using Fisher matrices is that full <b class="alert">MCMCs are extremely slow, and get slower with dimensionality</b>.</li>
						</ul>
					</div>
					<div class="col">
						<img data-src="assets/lanusse2015.png" style="width:700px" class="plain" /><br>
						<em>3D galaxy clustering with future wide-field surveys: Advantages of
							a spherical Fourier-Bessel analysis</em>,<br> <b>F. Lanusse</b>, A. Rassat, J.L. Starck (2015)
					</div>
			</section>

			<section class="inverted" data-background="#000">
				<h2>How can we scale cosmological analyses to the hundreds of parameters of modern
					surveys ?</h2>
			</section>

			<section>
				<h3 class="slide-title">the hammer behind the Deep Learning revolution: Automatic Differentation</h3>

				<ul>
					<li class="fragment"> <b>Automatic differentiation</b> allows you to compute analytic derivatives of arbitraty expressions:<br>
						If I form the expression $y = a * x + b$, it is separated in fundamental ops:
						$$ y = u + b \qquad u = a * x $$
						then gradients can be obtained by the chain rule:
						$$\frac{\partial y}{\partial x} = \frac{\partial y}{\partial u} \frac{ \partial u}{\partial x} = 1 \times a = a$$
					</li>
					<br>
					<li class="fragment"> This is a fundamental tool in Machine Learning, and autodiff frameworks include TensorFlow and PyTorch.
					</li>
				</ul>
				<br>
				<br>
				<div class="block fragment">
					<div class="block-title">
						Enters JAX: NumPy + Autograd + GPU
					</div>
					<div class="block-content">


						<div class="container">
							<div class="col">
								<ul>
									<li>JAX follows the NumPy api!
										<pre class="python"><code data-trim data-noescape>
								import jax.numpy as np
							</code></pre>
									</li>
									<li>Arbitrary order derivatives</li>
									<li>Accelerated execution on GPU and TPU</li>

								</ul>
							</div>
							<div class="col" align="center">

								<img data-src="https://raw.githubusercontent.com/google/jax/master/images/jax_logo_250px.png" class="plain" />
							</div>
						</div>
			</section>

			<section>
				<section>
					<h3 class="slide-title"> jax-cosmo: Finally a differentiable cosmology library, and it's in JAX!</h3>

					<div class="container">
						<div class="col">
							<img data-src="assets/github.png" class="plain" style="height:70px" />
							<div> <a href="https://github.com/DifferentiableUniverseInitiative/jax_cosmo/">https://github.com/DifferentiableUniverseInitiative/jax_cosmo</a>
							</div>

							<pre class="python"><code data-trim data-noescape>
								import jax.numpy as np
								import jax_cosmo as jc

								# Defining a Cosmology
								cosmo = jc.Planck15()

								# Define a redshift distribution with smail_nz(a, b, z0)
								nz = jc.redshift.smail_nz(1., 2., 1.)

								# Build a lensing tracer with a single redshift bin
								probe = probes.WeakLensing([nz])

								# Compute angular Cls for some ell
								ell = np.logspace(0.1,3)
								cls = angular_cl(cosmo_jax, ell, [probe])
							</code></pre>

							<div class="block fragment">
								<div class="block-title">
									Current main features
								</div>
								<div class="block-content">
									<ul>
										<li>Weak Lensing and Number counts probes</li>
										<li>Eisenstein & Hu (1998) power spectrum + halofit</li>
										<li>Angular $C_\ell$ under Limber approximation </li>
									</ul>
									<div class="fragment">$\Longrightarrow$ 3x2pt DES Y1 capable </div>
								</div>
							</div>

						</div>

						<div class="col">
							<img class="plain" data-src="assets/jc_vs_ccl_lensing.png" />
							<img class="plain" data-src="assets/jc_vs_ccl_clustering.png" />
							<br>
							Validating against the <a href="https://github.com/LSSTDESC/CCL">DESC Core Cosmology Library</a>
						</div>
					</div>
				</section>

				<section>
					<h3 class="slide-title"> let's compute a Fisher matrix</h3>

					<br>

					$$F = - \mathbb{E}_{p(x | \theta)}[ H_\theta(\log p(x| \theta)) ] $$

					<br>

					<div class="container">
						<div class="col fragment">

							<pre class="python"><code data-trim data-noescape>
			import jax
			import jax.numpy as np
			import jax_cosmo as jc

			# .... define probes, and load a data vector

			def gaussian_likelihood( theta ):
			  # Build the cosmology for given parameters
			  cosmo = jc.Planck15(Omega_c=theta[0], sigma8=theta[1])

			  # Compute mean and covariance
			  mu, cov = jc.angular_cl.gaussian_cl_covariance_and_mean(cosmo,
			                                                    ell, probes)
			  # returns likelihood of data under model
			  return jc.likelihood.gaussian_likelihood(data, mu, cov)

			# Fisher matrix in just one line:
			F = - jax.hessian(gaussian_likelihood)(theta)
			</code></pre>
							<a href="https://colab.research.google.com/github/DifferentiableUniverseInitiative/jax_cosmo/blob/master/docs/notebooks/jax-cosmo-intro.ipynb" target="_parent"><img src="https://colab.research.google.com/assets/colab-badge.svg"
									alt="Open In Colab" class="plain" style="height:25px;" /></a>
						</div>

						<div class="col fragment">
							<img data-src="assets/Fisher_mat.png" class="plain"><br><br>
						</div>
					</div>

					<ul>
						<li class="fragment"> <b class="alert">No derivatives were harmed by finite differences in the computation of this Fisher!</b> </li>
						<li class="fragment"> Only a small additional compute time compared to one forward evaluation of the model</li>
					</ul>

				</section>

			</section>

			<section>
				<h3 class="slide-title"> Inference becomes fast and scalable</h3>

				<div class="container">
					<div class="col">

						<ul>
							<li>Current cosmological MCMC chains take <b>days</b>, and typically require access
								to large computer clusters.</li>
							<br>
							<li class="fragment" data-fragment-index="1"><b class="alert">Gradients of the log posterior are required for modern efficient and scalable inference</b> techniques:
								<ul>
									<li>Variational Inference</li>
									<li>Hamiltonian Monte-Carlo</li>
								</ul>
							</li>
							<br>
							<li class="fragment" data-fragment-index="2">In jax-cosmo, we can trivially obtain <b>exact</b> gradients:
								<pre class="python"><code data-trim data-noescape>
			def log_posterior( theta ):
			    return gaussian_likelihood( theta ) + log_prior(theta)

			score = jax.grad(log_posterior)(theta)
			</code></pre>
							</li>

							<br>
							<li class="fragment" data-fragment-index="3">On a DES Y1 analysis, we find convergence in 70,000 samples with vanilla HMC, 140,000 with Metropolis-Hastings</li>
						</ul>

					</div>

					<div class="col">
						<div class="fragment" data-fragment-index="3">
							<img data-src="assets/jc_3x2pt_hmc.png" class="plain" /><br>
							DES Y1 posterior, jax-cosmo HMC vs Cobaya MH <br>(credit: Joe Zuntz)
						</div>
					</div>
				</div>

			</section>
			<!--
			<section>
				<h3 class="slide-title"> Example of application: the DESC 3x2pt tomography challenge</h3>



			<ul>
				<li>
				</li>

			</ul>
			</section> -->

			<section>
				<h3 class="slide-title">Takeaway message</h3>

				<br>
				<br>
				<ul>
					<li><b>Automatic differentation</b> has been a <b class="alert">game changer</b> for Machine Learning,
						it can be for physics as well. <br>
						$\Longrightarrow$ Fast inference; instant and accurate forecasts; survey optimization; data compression; etc.
					</li>
					<br>
					<li> jax-cosmo proposes a numpy-like cosmology library in the intuitive and powerful JAX framework.
					</li>
				</ul>

				<br>
				<br>

				<div class="block fragment">
					<div class="block-title">
						We need you!
					</div>
					<div class="block-content">
						Our goal is to build a high quality tool for the community
						<br>
						<br>
						<ul>
							<li> Completely open and collaborative development on GitHub: <a href="https://github.com/DifferentiableUniverseInitiative/jax_cosmo/">https://github.com/DifferentiableUniverseInitiative/jax_cosmo</a>
								</il>
								<br>
								<br>

							<li> Easily get in touch on Gitter for any questions <a
									href="https://gitter.im/DifferentiableUniverseInitiative/jax_cosmo?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge">https://gitter.im/DifferentiableUniverseInitiative/jax_cosmo</a>
							</li>
						</ul>
					</div>
				</div>
			</section>

			<section>
				<h1> Conclusion </h1>
			</section>

			<section>
				<h3 class="slide-title"> Conclusion </h3>
				<div class="block ">
					<div class="block-title">
						What can be gained by merging Deep Learning and Physical Models?
					</div>
					<div class="block-content">
						<br>
						<ul>
							<li class="fragment"> Complement known physical models with data-driven components
								<ul>
									<li>Learn galaxy morphologies from noisy and PSF-convolved data, for simulation purposes.</il>
									<li>Use data-driven model as prior for solving inverse problems such as deblending or deconvolution.</il>
								</ul>
								</il>
								<br>
								<br>

							<li class="fragment"> Differentiable physical models for fast inference
								<ul>
									<li> We are developing fast and distributed N-body simulations in TensorFlow.</li>
									<li> Even analytic cosmological computations can benefit from differentiability.<br> <a href="https://github.com/DifferentiableUniverseInitiative/jax_cosmo">https://github.com/DifferentiableUniverseInitiative/jax_cosmo</a> </li>
								</ul>
							</li>
							<br>
						</ul>
					</div>
				</div>
				<br>
				<div class="fragment">
					<u>Advertisement:</u>
					<br>
					<br>
					<ul>
						<li> <a href="https://gitter.im/DifferentiableUniverseInitiative">Differentiable Universe Initiative (gitter.im/DifferentiableUniverseInitiative)</a>: Group of people interested in making everything differentiable! join the conversation
							:-)
						</li>
					</ul>
				</div>

				<br>
				<p class="fragment">Thank you ! </p>
				<br> <br> <br>
			</section>

		</div>
	</div>

	<style>
		/* .reveal .slides {
			border: 5px solid red;
			min-height: 100%;
			width: 128mm;
			height: 96mm;
		} */

		.reveal .block {
			background-color: #191919;
			margin-left: 20px;
			margin-right: 20px;
			text-align: left;
			padding-bottom: 0.1em;
		}

		.reveal .block-title {
			background-color: #333333;
			padding: 8px 35px 8px 14px;
			color: #FFAA7F;
			font-weight: bold;
		}

		.reveal .block-content {
			padding: 8px 35px 8px 14px;
		}

		.reveal .slide-title {
			border-left: 5px solid white;
			text-align: left;
			margin-left: 20px;
			padding-left: 20px;
		}

		.reveal .alert {
			color: #FFAA7F;
			font-weight: bold;
		}

		.reveal .inverted {
			filter: invert(100%);
		}

		/*
	/* .reveal .alert {
	padding:8px 35px 8px 14px; margin-bottom:18px;
	text-shadow:0 1px 0 rgba(255,255,255,1);
	border:5px solid #FFAA7F;
	-webkit-border-radius: 14px; -moz-border-radius: 14px;
	border-radius:14px
	background-position: 10px 10px;
	background-repeat: no-repeat;
	background-size: 38px;
	padding-left: 30px; /* 55px; if icon
	}
	.reveal .alert-block {padding-top:14px; padding-bottom:14px}
	.reveal .alert-block > p, .alert-block > ul {margin-bottom:1em}
	/*.reveal .alert li {margin-top: 1em}
	.reveal .alert-block p+p {margin-top:5px} */
	</style>


	<script src="reveal.js/dist/reveal.js"></script>
	<script src="reveal.js/plugin/notes/notes.js"></script>
	<script src="reveal.js/plugin/markdown/markdown.js"></script>
	<script src="reveal.js/plugin/highlight/highlight.js"></script>
	<script src="reveal.js/plugin/math/math.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			controls: false,

			//center: false,
			hash: true,

			// Visibility rule for backwards navigation arrows; "faded", "hidden"
			// or "visible"
			controlsBackArrows: 'hidden',

			// Display a presentation progress bar
			progress: true,

			// Display the page number of the current slide
			slideNumber: true,

			transition: 'slide', // none/fade/slide/convex/concave/zoom

			// The "normal" size of the presentation, aspect ratio will be preserved
			// when the presentation is scaled to fit different resolutions. Can be
			// specified using percentage units.
			width: 1280,
			height: 720,

			// Factor of the display size that should remain empty around the content
			margin: 0.1,

			// Bounds for smallest/largest possible scale to apply to content
			minScale: 0.2,
			maxScale: 1.5,


			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes, RevealMath],

			dependencies: [{
					src: 'reveal.js/plugin/markdown/marked.js'
				},
				{
					src: 'reveal.js/plugin/markdown/markdown.js'
				},
				{
					src: 'reveal.js/plugin/notes/notes.js',
					async: true
				},
				{
					src: 'reveal.js/plugin/math/math.js',
					async: true
				},
				{
					src: 'reveal.js/plugin/reveal.js-d3/reveald3.js'
				},
				{
					src: 'reveal.js/plugin/reveal.js-plugins/chart/Chart.min.js'
				},
				{
					src: 'reveal.js/plugin/reveal.js-plugins/chart/csv2chart.js'
				},
				{
					src: 'reveal.js/plugin/highlight/highlight.js',
					async: true
				},
			]

		});
	</script>
</body>

</html>