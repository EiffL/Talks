<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>CosmicRIM: Reconstructing Early Universe by Combining Differentiable Simulations with Recurrent Inference Machines</title>

	<meta name="description" content="DPhP Seminar, June 14th 2021">
	<link rel="stylesheet" href="reveal.js/dist/reset.css">
	<link rel="stylesheet" href="reveal.js/dist/reveal.css">
	<link rel="stylesheet" href="reveal.js/dist/theme/darkenergy.css" id="theme">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="reveal.js/plugin/highlight/monokai.css" id="highlight-theme">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<section class="fig-container" data-file="flowpm_static.html">
				<div class="container">
					<div class="title" style="border-radius: 20px; background-color:rgba(0, 0, 0, 0.4);">
						<h1>CosmicRIM</h1>
						<h2>Reconstructing Early Universe by Combining Differentiable Simulations with Recurrent Inference Machines
						</h2>
					</div>
				</div>
				<hr>

				<h2>François Lanusse</h2>
				<h3>C. Modi, U. Seljak, D. Spergel, L. Perreault-Levasseur</h3>
				<div style="border-radius: 20px; background-color:rgba(0, 0, 0, 0);">
					<div class="container">
						<div class="col">
							<div align="left" style="margin-left: 20px;">
								<!-- <h2>François Lanusse</h2>
								<h3>C. Modi, U. Seljak, D. Spergel, L. Perreault-Levasseur</h3> -->
								<!-- <br> -->
								<img src="assets/CosmoStatDarkBK.png" class="plain"></img>
								<br>
							</div>
						</div>

						<div class="col">
							<!-- <br>
							<br>
							<br>
							<br> -->
							<img src="assets/logo_cnrs.png" class="plain" height="150"></img>
						</div>

						<div class="col">
							<!-- <br>
							<br>
							<br> -->
							<img src="assets/aim.png" class="plain" height="150"></img>
						</div>
					</div>
					<div> slides at <a href="https://eiffl.github.io/talks/DPhP2021">eiffl.github.io/talks/DPhP2021</a> </div>
				</div>
			</section>



			<section>
				<section data-background-image="assets/WMAP_timeline_large.jpg">
					<h3 class='slide-title' style="position:absolute;top:0;"> the $\Lambda$CDM view of the Universe </h3>
					<br> <br>
					<div class="container">
						<div class="col" style="flex: 0 0 40em;">

						</div>
						<div class="col">

							<img class="plain" data-src="assets/Euclid.png" style="width: 250px" />

							<img class="plain" data-src="assets/desi.jpg" style="width: 250px" />

							<img class="plain" data-src="assets/vrro.png" style="width: 250px" />
						</div>
					</div>
					<br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br> <br>
				</section>


				<section data-background-video="assets/animation-day-to-night.mov" data-background-video-muted>
					<h3 class='slide-title'>the Vera C. Rubin Legacy Survey of Space and Time</h3>
					<div class="container">
						<div class="col">
							<ul>
								<li class="fragment fade-up"> 1000 images each night, 15 TB/night for 10 years</li>
								<br>
								<li class="fragment fade-up"> 18,000 square degrees, observed once every few days</li>
								<br>
								<li class="fragment fade-up"> Tens of billions of objects, each one observed $\sim1000$ times</li>
							</ul>
							<br>
							<!-- <p class="fragment fade-up"> $\Longrightarrow$ Incredible potential for discovery, along with <b>unprecedented challenges</b >.</p> -->
						</div>

						<div class="col">
							<video class="fragment fade-up" data-fragment-index="1" data-autoplay data-src="assets/obsim.mp4" type="video/mp4" />
						</div>
					</div>

				</section>
				<!-- <section data-transition="fade-in fade-out" data-background="assets/gal_sdss.png" data-vertical-align-top>
													<p>Previous generation survey: SDSS</p>
													<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>
													<br>	<br>	<br>	<br>	<br>	<br>	<br>
									 								<div style="float:right; font-size: 20px">Image credit: Peter Melchior</div>
									 			</section>
									 			<section data-transition="fade-in fade-out" data-background="assets/gal_des.png" data-vertical-align-top>
													<p>Current generation survey: DES</p>
													<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>
													<br>	<br>	<br>	<br>	<br>	<br>	<br>
									 								<div style="float:right; font-size: 20px">Image credit: Peter Melchior</div>
									 			</section>
												<section data-transition="fade-in fade-out" data-background="assets/gal_hsc.png" data-vertical-align-top>
													<p>LSST precursor survey: HSC</p>

													<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>	<br>
													<br>	<br>	<br>	<br>	<br>	<br>	<br>
									 								<div style="float:right; font-size: 20px">Image credit: Peter Melchior</div>
								 			</section> -->
				<section>
					<h3 class='slide-title'>Modern cosmological surveys </h3>
					<div class="container">
						<div class="col" style="flex: 0 0 30em;">

							<div class="block fragment" data-fragment-index="0">
								<div class="block-title">
									A Blessing
								</div>
								<div class="block-content">
									<ul>
										<li>Unprecedented statistical power
										</li>
										<br>
										<li>Great potential for new discoveries
										</li>
									</ul>
								</div>
							</div>

							<br>
							<div class="block fragment" data-fragment-index="1">
								<div class="block-title">
									Some of the challenges
								</div>
								<div class="block-content">
									<ul>
										<li class="fragment" data-fragment-index="1">How to combine different cosmological probes </li>
										<br>
										<li class="fragment" data-fragment-index="2">What are the optimal summary statistics? <br>
											$\rightarrow$ <b>2 point function</b>, 3 point function, peak counts ...
										</li>
										<br>
										<li class="fragment" data-fragment-index="3"> MCMC to recover a posterior on model parameters <br>
											$\rightarrow$ <b class="alert">analytic likelihood</b> :
											$p(\theta | x ) \propto \underbrace{p(x | \theta)}_{\mathrm{likelihood}} \ \underbrace{p(\theta)}_{\mathrm{prior}}$
										</li>

									</ul>
								</div>

							</div>

						</div>
						<div class="col">
							<div style="position:relative; width:480px; height:420px; margin:0 auto;">
								<img class="fragment current-visible" data-src="assets/LSST_forecast_Y10.png" style="position:absolute;top:0;left:0;" data-fragment-index="0" />
								<img class="fragment current-visible plain" data-src="assets/cov.png" style="position:absolute;top:0;left:0;" data-fragment-index="1" />
								<img class="fragment current-visible plain" data-src="assets/nbody.png" data-fragment-index="2" />
								<img class="fragment  plain" data-src="assets/hsc_constraints.png" style="position:absolute;top:0;left:0;" data-fragment-index="3" />
							</div>
							<div class="fragment current-visible" data-fragment-index="0" style="position:absolute; font-size: 20px;  left:900px">DESC Collaboration: 1809.01669</div>
							<div class="fragment current-visible" data-fragment-index="1" style="position:absolute; font-size: 20px;  left:980px">Krause &amp; Eifler 2016</div>
							<div class="fragment" data-fragment-index="3" style="position:absolute; font-size: 20px; top:500px; left:1030px">Hikage et al. 2018</div>
						</div>
					</div>
					<br>
					<div class="fragment">
						$\Longrightarrow$ Dire need for <b class="alert">novel analysis techniques</b> to fully realize the potential of modern surveys.
					</div>
				</section>
			</section>

			<!-- <section>
				<h3 class='slide-title'> traditional cosmological inference </h3>
				<div class='container'>
					<div class='col'>
						<div style="position:relative; width:480px; height:30px; margin:0 auto;">
							<div class="fragment current-visible" style="position:absolute;top:0;" data-fragment-index="1">HSC cosmic shear power spectrum</div>
							<div class="fragment" style="position:absolute;top:0;" data-fragment-index="2">HSC Y1 constraints on $(S_8, \Omega_m)$</div>
						</div>
						<div style="position:relative; width:480px; height:300px; margin:0 auto;">
							<div class="fragment current-visible" style="position:absolute;top:0;left:0;" data-fragment-index="0">
								<img class="plain" data-src="assets/alonso_g1.png" />
								<img class="plain" data-src="assets/alonso_g2.png" />
							</div>
							<img class="fragment current-visible plain" data-src="assets/hsc_correlation_function.png" style="position:absolute;top:0;left:0;" data-fragment-index="1" />
							<img class="fragment  plain" data-src="assets/hsc_constraints.png" style="position:absolute;top:0;left:0;" data-fragment-index="2" />
						</div>
						<div class="fragment" data-fragment-index="1" style="float:right; font-size: 20px">(Hikage,..., Lanusse, et al. 2018)</div>
					</div>

					<div class='col'>
						<ul>
							<li class="fragment" data-fragment-index="0"> Measure the ellipticity $\epsilon = \epsilon_i + \gamma$ of all galaxies<br>
								$\Longrightarrow$ Noisy tracer of the weak lensing shear $\gamma$ </li>
							<br>
							<li class="fragment" data-fragment-index="1"> Compute <b class="alert">summary statistics</b> based on 2pt functions, <br>e.g. the <b>power spectrum</b> </li>
							<br>
							<li class="fragment" data-fragment-index="2"> Run an MCMC to recover a posterior on model parameters, using an <b class="alert">analytic likelihood</b>
								$$ p(\theta | x ) \propto \underbrace{p(x | \theta)}_{\mathrm{likelihood}} \ \underbrace{p(\theta)}_{\mathrm{prior}}$$
							</li>
						</ul>
					</div>
				</div>

				<div class="block fragment">
					<div class="block-title">
						Main limitation: the need for an explicit likelihood
					</div>
					<div class="block-content">
						We can only compute the likelihood for <b>simple summary statistics</b> and on <b>large scales</b>
						<br>
						<br>
						<div class="fragment"> $\Longrightarrow$ We are dismissing most of the information! </div>
					</div>
				</div>
			</section> -->

			<!--
			            - The problem: Traditional inference is limited, relies on analytical
			            techniques, and even then, requires a lot of simulations.
			              -> Why is it difficult? because we are trying to piece many components together

			            - The solution: Hierarchical modeling, forward modeling
			              -> The full forward process defining our observation is described in terms of a Probabilistic Hierarchical model

			            - Now, we have this model, the  question is how do we do efficient inference
			              -> One thing is clear, we cannot go blindly to explore this extremely large dimensional space by
			              sampling
			              -> There are a number of inference techniqes that have been proposed to solve this kind of large scale inference problem
			                 Again, one thing is clear, having access to derivatives is better than the alternative

			            -> Hence the need for fast, accurate, differentiable forward simulations
			              - In this talk, I am introducing FlowPM, a first building block for the whole picture

			              Section I:
			                - We go over what N-body simulations are
			                - How Particle-Mesh solvers work
			                - Showcase the implementation in TensorFlow
			                - Show an example of bridging the simulation with ML elements
			                - Show an example of reconstructing a MAP solution of the initial conditions of the universe

			              Section II:
			                - General Purpose Distributed differentiable framework
			                - Mesh TensorFlow as a possible solution

			          -->
			<section>
				<h3 class='slide-title'>A different road: forward modeling</h3>

				<div class='container'>
					<div class='col'>

						<ul>
							<li> Instead of trying to analytically evaluate the likelihood,
								let us build a forward model of the observables.</li>
							<br>
							<li class="fragment"> Each component of the model is now tractable, but at the
								cost of a <b>large number of latent variables</b>.
							</li>
						</ul>

						<br>
						<br>
						<div class="fragment">
							$\Longrightarrow$ How to peform efficient inference in this large number of dimensions?
						</div>
						<br>
						<br>
						<ul class="fragment"> A non-exhaustive list of methods:
							<li> Hamiltonian Monte-Carlo
							</li>
							<li> Variational Inference
							</li>
							<li> MAP+Laplace
							</li>
							<li> Gold Mining
							</li>
							<li> Dimensionality reduction by Fisher-Information Maximization
							</li>
						</ul>
						<div class="fragment">
							What do they all have in common?<br>
							-> They require fast, accurate, <b class="alert">differentiable forward simulations</b>
						</div>
					</div>

					<div class='col'>
						<img data-src="assets/pgm_lensing.png" class="plain" style="height:550px;" />

						<div style="float:right; font-size: 20px">(Schneider et al. 2015)</div>
					</div>
				</div>
			</section>


			<section>
				<section>
					<h3 class='slide-title'>Bayesian Reconstruction of Cosmological Fields</h3>
					<img data-src="assets/evolvingLSS.jpg" class="plain" /><br>
					<div class="fragment">Going back to simpler times...</div>

					<div class="fragment">
						$$\arg\max_s \ \log p(x | f(s)) \ + \ p(s) $$
						where:<br>
						<ul>
							<li> $f$ is the <b>forward model</b>
							</li>
							<li> $p(x | f(s))$ is a tractable data likelihood
							</li>
							<li> $s$ are the <b>initial conditions</b> (early universe)
							</li>
							<li> $x$ is the data (e.g. galaxies, lensing, etc.)
							</li>
						</ul>
					</div>
				</section>

				<section>
					<h3 class='slide-title'>Example use-case: Baryon Acoustic Oscillations </h3>

					<i> Most robust probes for dark energy from galaxy surveys like DESI </i>

					<br>
					<br>

					<div class="container">

						<div class="col">
							<ul>
								<li class="fragment" data-fragment-index="0">Pressure waves in the primordial photon-baryon fluids </li>
								<br>
								<li class="fragment" data-fragment-index="0">Frozen at the time of decoupling <br>$\rightarrow$ Clustering at preferred scale </li>
								<br>
								<li class="fragment" data-fragment-index="0"> Damping due to non-linear evolution</li>
								<br>
								<li class="fragment" data-fragment-index="4"> Fisher information <br> <br>
									$F_{ij} = V_{\rm{eff}}\int_{k_{min}}^{k_{max}} \frac{\partial {\rm ln} P(k)}{\partial p_i} \frac{\partial {\rm ln} P(k)}{\partial p_j}\frac{4 \pi k^2}{2 (2\pi)^3} dk \quad \mathbf{\propto \, r_c^4} $
								</li>

							</ul>
						</div>

						<div class="col">
							<!-- <\!-- <div class="col"> -\-> -->
							<div style="position:relative; width:600px; height:400px; top:130px; left:50px;  margin:1 auto">

								<Img class="fragment current-visible plain" data-fragment-index="3" style="position:absolute;top:-150px;left:0px;" data-src="assets/bao_damping.jpg" />

								<img class="fragment plain" data-fragment-index="4" style="position:absolute;top:-50px;left:0px;" data-src="assets/realrccfig.png" />

							</div>
							<div class="fragment current-visible plain" data-fragment-index="3" style="position:absolute; float:right; top:550px; right:00px; font-size: 20px; margin:0 auto">Padmanabhan et al. 2012</div>
							<div class="fragment current-visible" data-fragment-index="4" style="position:absolute; float:right;  top:550px; right:0px; font-size: 20px; margin:0 auto">Seo et al. 2007</div>
							<div class="fragment current-visible" data-fragment-index="4" style="position:absolute; float:right;  top:570px; right:0px; font-size: 20px; margin:0 auto">Modi et al. 2018</div>
						</div>
					</div>
					<br><br>

				</section>
			</section>

			<section>
				<h3 class='slide-title'>Forward Models in Cosmology</h3>
				$$\arg\max_s \ \log p(x | f(s)) \ + \ p(s) $$
				<div class="container">
					<div class='col'>
						<img data-src="assets/fieldinit.png" class="plain" style="height:300px;" />
						<b class="alert"> Linear Field $s$ </b>
					</div>
					<div class='col fragment' data-fragment-index='2'>
						<img data-src="assets/fieldfin.png" class="plain " style="height:300px;" />
						<b class="alert"> Final Dark Matter </b>
					</div>
					<hr style="width: 1px; height: 400px; background: white; border: none;" />
					<div class='col fragment' data-fragment-index='3'>
						<img data-src="assets/fieldhalo.png" class="plain " style="height:300px;" />
						<b class="alert"> Dark Matter Halos </b>
					</div>
					<div class='col fragment' data-fragment-index='4'>
						<img data-src="assets/fieldgal.png" class="plain " style="height:300px;" />
						<b class="alert"> Galaxies $x$ </b>
					</div>
				</div>
				<div class="container" style="position:relative; width:1000px; height:50px; margin:0 auto;">
					<div class='col fragment' data-fragment-index='2'>
						<font size="10"> $\longrightarrow$ </font> <br>
						<div class="fragment grow" data-fragment-index='5'>N-body simulations </div>
					</div>
					<div class='col fragment' data-fragment-index='3'>
						<font size="10"> $\longrightarrow$ </font> <br> Group Finding <br> algorithms
					</div>
					<div class='col fragment' data-fragment-index='4'>
						<font size="10"> $\longrightarrow$ </font> <br> Semi-analytic &amp <br> distribution models
					</div>
					<!-- 		<div class='fragment' data-fragment-index='2'> N-body simulations <div> -->
					<!-- <div class='fragment' data-fragment-index='3'> Group Finding algorithms <div> -->
					<!-- <div class='fragment' data-fragment-index='4'> Semi-analytic models <div> -->
				</div>
			</section>

			<section data-autoplay data-background-iframe="https://www.youtube.com/embed/YjUICiYlCYE?controls=0&autoplay=1&fs=0&loop=1" data-background-interactive=false data-preload>
			</section>


			<section class="inverted" data-background="#000">
				<h2>How do we make cosmological simulations <b>fast</b> and <b>differentiable</b>?</h2>
			</section>


			<section>
				<h3 class="slide-title">the hammer behind the Deep Learning revolution</h3>
				<br>
				<ul>
					<li class="fragment"> <b>Automatic differentiation</b> allows you to compute analytic derivatives of arbitraty expressions:<br>
						If I form the expression $y = a * x + b$, it is separated in fundamental ops:
						$$ y = u + b \qquad u = a * x $$
						then gradients can be obtained by the chain rule:
						$$\frac{\partial y}{\partial x} = \frac{\partial y}{\partial u} \frac{ \partial u}{\partial x} = 1 \times a = a$$
					</li>
					<br>
					<li class="fragment"> This is a fundamental tool in Machine Learning, and autodiff frameworks include <b>TensorFlow</b>, <b>JAX</b> or PyTorch.
						<div class="container">
							<div class="col">
								<img data-src="assets/TF_FullColor_Horizontal.png" />
							</div>

							<div class="col">
								<img data-src="https://raw.githubusercontent.com/google/jax/master/images/jax_logo_250px.png" class="plain" />
							</div>
						</div>
						$\Longrightarrow$ In addition to autodiff, they all provide <b>GPU/TPU acceleration</b>.
					</li>
				</ul>
				<br>
				<br>
			</section>

			<section>
				<h3 class='slide-title'>the Fast Particle-Mesh scheme</h3>

				<b>The idea</b>: approximate gravitational forces by estimating densities on a grid.

				<div class='container'>
					<div class='col'>
						<ul>
							<li>The numerical scheme:
								<br>
								<br>
								<ul>
									<li class="fragment" data-fragment-index="1"> Estimate the density of particles on a mesh<br>
										=> compute gravitational forces by FFT
									</li>

									<br>

									<li class="fragment" data-fragment-index="2"> Interpolate forces at particle positions
									</li>

									<br>

									<li class="fragment" data-fragment-index="3"> Update particle velocity and positions, and iterate
									</li>
								</ul>
							</li>
							<br>

							<li class='fragment'> Fast and simple, at the cost of approximating short range interactions.
							</li>

						</ul>
					</div>

					<div class='col'>

						<div style="position:relative; width:550px; height:550px; margin:0 auto;">
							<img class="fragment current-visible plain" data-src="assets/particle_positions_0.png" style="position:absolute;top:0;left:0;" data-fragment-index="0" />
							<img class="fragment current-visible plain" data-src="assets/particle_density_0.png" style="position:absolute;top:0;left:0;" data-fragment-index="1" />
							<img class="fragment current-visible plain" data-src="assets/particle_positions_0.png" style="position:absolute;top:0;left:0;" data-fragment-index="2" />
							<img class="fragment  plain" data-src="assets/particle_positions_1.png" style="position:absolute;top:0;left:0;" data-fragment-index="3" />

						</div>

					</div>
				</div>

				<div class="fragment"> $\Longrightarrow$ Only a series of FFTs and interpolations.</div>
			</section>

			<section>
				<h3 class='slide-title'>Introducing FlowPM: Particle-Mesh Simulations in TensorFlow</h3>
				<div class="container">
					<div class="col">
						<div style="float:right; font-size: 20px"> Modi, <b>Lanusse</b>, Seljak (2020)
							<a href="https://arxiv.org/abs/2010.11847"><img src="https://img.shields.io/badge/astro--ph.CO-arXiv%3A2010.11847-B31B1B.svg" class="plain" style="height:25px;vertical-align:middle;" /></a>
						</div>
					</div>
				</div>
				<div class='container'>
					<div class='col'>
						<img data-src="assets/github.png" class="plain" style="height:70px" />
						<img data-src="assets/TF_FullColor_Horizontal.png" class='plain' style="height: 70px;" />

						<div> <a href="https://github.com/DifferentiableUniverseInitiative/flowpm">https://github.com/DifferentiableUniverseInitiative/flowpm</a>
						</div>
						<pre class="python"><code data-trim data-noescape>
import tensorflow as tf
import flowpm
# Defines integration steps
stages = np.linspace(0.1, 1.0, 10, endpoint=True)

initial_conds = flowpm.linear_field(32,       # size of the cube
                                    100,      # Physical size
                                    ipklin,   # Initial powerspectrum
                                    batch_size=16)

# Sample particles and displace them by LPT
state = flowpm.lpt_init(initial_conds, a0=0.1)

# Evolve particles down to z=0
final_state = flowpm.nbody(state, stages, 32)

# Retrieve final density field
final_field = flowpm.cic_paint(tf.zeros_like(initial_conditions),
                               final_state[0])
													</code></pre>
						<ul>
							<li> Seamless interfacing with deep learning components
							</li>
							<li> Gradients readily available
							</li>
						</ul>
						<br>
						<br>
						<br>
						<br>
						<br>
					</div>

					<div class='col'>
						<div class="fig-container" data-file="flowpm_16.html" data-style="height: 550px;"></div>
						<br>
						<br>
						<br>
						<br>
					</div>
				</div>
			</section>


			<section>
				<h3 class="slide-title"> MAP optimization in action</h3>
				$$\arg\max_s \ \log p(x_{dm} | f(s)) \ + \ p(s) $$
				<div style="float:right; font-size: 16px">credit: <a href="https://github.com/modichirag">C. Modi</a></div>
				<br>
				<div class="container">
					<div class="col fragment fade-up">
						<img data-src="assets/init_field.png" style='height:250px;' />
						<br> True initial conditions <br> $s_0$
					</div>

					<div class="col">
						<img data-src="assets/reconim_init.gif" style='height:250px;' />
						<br> Reconstructed initial conditions $s$
					</div>

					<div class="col">
						<img data-src="assets/reconim_fin.gif" style='height:250px;' />
						<br> Reconstructed dark matter distribution $x_{dm} = f(s)$
					</div>

					<div class="col">
						<img data-src="assets/fin_field.png" style='height:250px;' />
						<br> Data <br> $x_{dm} = f(s_0)$
					</div>
				</div>
				<br>
				<br>

				<div class="fragment">
					Check out this blogpost for more details <br> <a href=https://blog.tensorflow.org/2020/03/simulating-universe-in-tensorflow.html>
						https://blog.tensorflow.org/2020/03/simulating-universe-in-tensorflow.html</a>
				</div>
			</section>


			<section>
				<section>
					<h3 class='slide-title'>Forward Models in Cosmology</h3>
					<div class="container">
						<div class='col'>
							<img data-src="assets/fieldinit.png" class="plain" style="height:300px;" />
							<b class="alert"> Linear Field </b>
						</div>
						<div class='col '>
							<img data-src="assets/fieldfin.png" class="plain " style="height:300px;" />
							<b class="alert"> Final Dark Matter </b>
						</div>
						<hr style="width: 1px; height: 400px; background: white; border: none;" />
						<div class='col fragment' data-fragment-index='3'>
							<img data-src="assets/fieldhalo.png" class="plain " style="height:300px;" />
							<b class="alert"> Dark Matter Halos </b>
						</div>
						<div class='col fragment' data-fragment-index='4'>
							<img data-src="assets/fieldgal.png" class="plain " style="height:300px;" />
							<b class="alert"> Galaxies </b>
						</div>
					</div>
					<div class="container" style="position:relative; width:1000px; height:50px; margin:0 auto;">
						<div class='col'>
							<font size="10"> $\longrightarrow$ </font> <br> N-body simulations <br> <b class="alert">FlowPM</b>
						</div>
						<div class='col fragment' data-fragment-index='3'>
							<font size="10"> $\longrightarrow$ </font> <br> Group Finding <br> algorithms
						</div>
						<div class='col fragment' data-fragment-index='4'>
							<font size="10"> $\longrightarrow$ </font> <br> Semi-analytic &amp <br> distribution models
						</div>
						<!-- 		<div class='fragment' data-fragment-index='2'> N-body simulations <div> -->
						<!-- <div class='fragment' data-fragment-index='3'> Group Finding algorithms <div> -->
						<!-- <div class='fragment' data-fragment-index='4'> Semi-analytic models <div> -->
					</div>
				</section>

				<section>
					<h3 class='slide-title'> Example of Extending Dark Matter Simulations with Deep Learning</h3>

					<div style="position:relative; width:1000px; height:290px; margin:0 auto;">
						<img style="position:absolute;top:0;left:50px;" data-src="assets/recontruth.png" height="300" />
					</div>
					<div style="position:relative; width:1000px; height:290px; margin:0 auto;">
						<div class="fragment " data-fragment-index="0" style="position:absolute;top:10px;left:600px;font-size:200%"> $\longrightarrow$ </div>
						<img class="fragment plain" data-fragment-index="0" style="position:absolute;top:50px;left:500px;" data-src="assets/fnn.png" height="150" />
						<img class="fragment " data-fragment-index="1" style="position:absolute;top:0;left:50px;" data-src="assets/reconinit.png" height="300" />
						<img class="fragment " data-fragment-index="2" style="position:absolute;top:0;left:50px;" data-src="assets/reconrecon.png" height="300" />
					</div>
					<div class="fragment" data-fragment-index="1" style="position:relative; float:right; top: -30px; left:-50px; font-size: 20px; margin:0 auto">Modi et al. 2018</div>

				</section>
			</section>

			<section>
				<h3 class="slide-title">If only MAP optimization was easy...</h3>

				$$\arg\max_s \ \log p(x_{dm} | f(s)) \ + \ p(s) $$

				<div class="container">
					<div class="col">
						Direct optimization
						<div style="position:relative; width:600px; height:410px; margin:0 auto;">
							<img style="position:absolute;top:0;left:0px;" data-src="assets/recon_illustration0.png" height="350" />
							<img class="fragment " data-fragment-index="1" style="position:absolute;top:0;left:0px;" data-src="assets/recon_illustration1.png" height="350" />
						</div>

					</div>
					<div class="col fragment" data-fragment-index="2">
						ad-hoc annealing
						<div style="position:relative; width:600px; height:410px; margin:0 auto;">
							<img class="fragment " data-fragment-index="2" style="position:absolute;top:0;left:5px;" data-src="assets/recon_illustration2.png" height="350" />
							<img class="fragment " data-fragment-index="3" style="position:absolute;top:0;left:5px;" data-src="assets/recon_illustration3.png" height="350" />
							<img class="fragment " data-fragment-index="4" style="position:absolute;top:0;left:5px;" data-src="assets/recon_illustration4.png" height="350" />
							<img class="fragment " data-fragment-index="5" style="position:absolute;top:0;left:5px;" data-src="assets/recon_illustration5.png" height="350" />
						</div>
					</div>
				</div>

				<div>
					<ul>
						<li> Direct optimization of MAP leads to poor solutions on large scales.
						</li>
						<li class="fragment">Annealing recovers unbiased large scales, but at the cost of ad-hoc tempering procedure.
						</li>
					</ul>
				</div>
			</section>

			<section class="inverted" data-background="#000">
				<h2>Instead of guessing an optimization scheme, could we <b>learn to optimize</b>?</h2>
			</section>

			<section>
				<h3 class="slide-title">A closer look at the optimization algorithm</h3>

				<br>

				$$\arg\max_x \ \log p(y | f(x)) \ + \ p(x) $$

				<div class="container">
					<div class="col">
						<ul>
							<li> Standard Gradient Descent Algorithm:
								$$x_{i+1} = x_i - \epsilon \left[ \nabla_x{\log p(y | f(x_i))} + \nabla_x \log p(x_i) \right]$$
								<br>
								<div class="fragment" data-fragment-index="2">$$x_{i+1} = x_i - \Gamma \left(\nabla_x{\log p(y | f(x_i))}, \nabla_x \log p(x_i) \right]$$
									with <b class="alert">update function</b> $\Gamma: (u,v) \rightarrow \epsilon(u + v)$ </div>
							</li>
							<br>
							<br>
							<li class="fragment"> Many algorithms (e.g. ADAM, LBFGS) can expressed in this form with a different choice of $\Gamma$.
							</li>
						</ul>

					</div>
					<div class="col fragment" data-fragment-index="1">
						<img data-src="assets/map.png" />
					</div>
				</div>

				<br>
				<div class="fragment">
					$\Longrightarrow$ What if we could learn this update function?
				</div>
			</section>

			<section>
				<section>
					<h3 class="slide-title">Recurrent Inference Machines for Solving Inverse Problems<br> <a href="https://arxiv.org/abs/1706.04008">Putzky & Welling, 2017</a></h3>

					<img data-src="assets/illustration_RIM.png" />

					<div class="container">
						<div class="col">
							<ul>
								<li> Introduce a Recurrent Neural Network (RNN) $h_\phi$, and state variable $s$, so that:
									$$ s_{i+1} = h^*_\phi( \nabla \log p(y|x_{i}), x_i, s_{i})$$
									$$ x_{i+1} = x_i + h_\phi(\nabla \log p(y|x_{i}), x_i, s_{i+1})$$
								</li>

							</ul>
						</div>
						<div class="col fragment">
							<ul>
								<li> Train according to:
									$$\mathcal{L} = \sum_{i}^T w_i\mathcal{L}(x_i, x)$$
								</li>
							</ul>
						</div>
					</div>
				</section>

				<section>
					<h3 class="slide-title">Illustration on inverse problems</h3>
					<br>
					<br>
					<br>
					<br>
					<div>
						<img data-src="assets/IllustrationRIM.png" /><br>
						From left to right: input masked image, increasing number of steps of solutions, ground truth.
					</div>
					<br>
					<br>
					<br>
					<br>
				</section>
			</section>

			<section>
				<section>
					<h3 class="slide-title">CosmicRIM: Recurrence Inference Machines for Initial Condition Reconstruction</h3>
					<div class="container">
						<div class="col">
							<div style="float:right; font-size: 20px"> Modi, <b>Lanusse</b>, Seljak, Spergel, Perreault-Levasseur (2021)
								<a href="https://arxiv.org/abs/2104.12864"><img src="https://img.shields.io/badge/astro--ph.CO-arXiv%3A2104.12864-B31B1B.svg" class="plain" style="height:25px;vertical-align:middle;" /></a>
							</div>
						</div>
					</div>
					<br>

					<div class="container">

						<div class="col">
							Recurrent Neural Network Architecture
							<img data-src="assets/cosmic_rim.png" width="450" />
						</div>

						<div class="col">

							<ul>
								<li>A few notable differences to a vanilla RIM:
									<ul>
										<li>We provide gradients of both prior and likelihood to the model.</li>

										<br>
										<li>Because our forward model couples scales, we use a multiscale U-Net architecture.</li>
										<br>
										<li> Input gradients are pre-scaled with the ADAM formula.</li>
									</ul>
								</li>

							</ul>

						</div>
					</div>
					<br>
				</section>

				<section>
					<h3 class="slide-title">Experiments</h3>
					<div class="block ">
						<div class="block-title">
							Settings
						</div>
						<div class="block-content">
							<ul>
								<li>Forward model: $64^3$ particles, 400 Mpc/h box, 2LPT dynamics with 2nd order bias model
								</li>
								<li> RIM: 10 steps, trained under l2 loss
								</li>
							</ul>
						</div>
					</div>

					<div class="container">

						<div class="col">
							Initial conditions cross-correlation
							<img data-src="assets/cosmic_rim_rc.png" width="500" />

						</div>
						<div class="col">
							Transfer function<br>
							<img data-src="assets/rim_transfer.png" width="500" />
						</div>

					</div>
					<ul>
						<li>CosmicRIM: Learn to optimize by embedding a Neural Network in the optimization algorithm.<br>
							$\Longrightarrow$ converges 40x faster than LBFGS.</li>
					</ul>

				</section>
			</section>

			<section class="inverted" data-background="#000">
				<h2>$64^3$? too small, it's never going to be useful for anything!</h2>
			</section>

			<section>
				<h3 class='slide-title'>The practical challenges of large-scale deep learning</h3>

				<br>
				<br>

				<div class="container">
					<div class="col">
						<ul>
							<li> Simulations of scientifically interesting sizes <b>do not fit on a single GPU RAM</b>.<br>
								$\Longrightarrow$ We need for a distributed Machine Learning Framework
							</li>

							<br>

							<li class="fragment" data-fragment-index="1">Most common form of distribution is <b>data-parallelism</b>
								$\Longrightarrow$ Reached Exascale on scientific deep learning applications
							</li>

							<br>

							<li class="fragment"> What we need is <b>model-parallelism</b> on HPC environments
							</li>
						</ul>
					</div>

					<div class="col">
						<img data-src="assets/summit.png" class="fragment" data-fragment-index="1">
					</div>
				</div>

				<br>
				<br>

				<div class="fragment">
					$\Longrightarrow$ We are developing the <b class="alert">Mesh TensorFlow</b> framework for large-scale GPU clusters.
				</div>
			</section>

			<section>
				<h3 class='slide-title'>Mesh TensorFlow in a few words</h3>
				<ul>
					<li> Redefines the TensorFlow API, in terms of abstract <em>logical tensors</em>
						<ul> The actual instantiation of the memory on multiple devices depends on:
							<li class="fragment" data-fragment-index="1"> The specification of the mesh of computing devices
							</li>
							<li class="fragment" data-fragment-index="2"> The specification of rules for which dimensions can be splitted
							</li>
						</ul>
					</li>
				</ul>

				<img class="fragment" data-fragment-index="3" data-src="assets/mesh_tensorflow.png" /><br>
				<div class="fragment" data-fragment-index="3" style="float:right; font-size: 20px">(Gholami et al. 2018)</div>
			</section>

			<section>
				<h3 class='slide-title'>Mesh FlowPM: distributed, GPU-accelerated, and automatically differentiable simulations</h3>
				<!--
				<img data-src="assets/mesh_flopwm.png" class="plain" style="height:450px;" /> -->

				<div class="container">
					<div class="col">
						<img data-src="assets/mfpm_demo_1024.png" />
					</div>

					<div class="col">
						<ul>
							<li> Working MeshTF fork resulting from collaboration with NVIDIA and the Jean-Zay user team.
							</li>
							<br>
							<br>
							<li> For a $2048^3$ simulation:
								<ul>
									<li>Distributed on <b>256</b> NVIDIA V100 GPUs</li>
									<li>Runtime: 3 mins</li>
								</ul>
							</li>
							<br>
							<br>
							<li> Don't hesitate to reach out if you have a use case for model parallelism!<br>
								<img data-src="assets/github.png" class="plain" style="height:70px" /><br>

								<div> <a href="https://github.com/DifferentiableUniverseInitiative/mesh">https://github.com/DifferentiableUniverseInitiative/mesh</a>
								</div>
							</li>
						</ul>
					</div>
				</div>
			</section>

			<section>
				<h2>Conclusion </h2>
			</section>

			<section>
				<h3 class="slide-title"> Conclusion </h3>

				<div class="block ">
					<div class="block-title">
						Main Takeaways
					</div>
					<div class="block-content">
						<ul>
							<li class="fragment fade-up"> <b class="alert">Cosmological Forward Modelling</b>.<br>
								$\Longrightarrow$ Bypass the need for analytic likelihoods and goes towards optimal inference.
							</li>
							<br>
							<li class="fragment fade-up"> <b class="alert">Differentiable Simulations</b>.<br>
								$\Longrightarrow$ Enable efficient simulator-based inference and hybrid physical/deep learning models.
							</li>
							<br>
							<li class="fragment fade-up"> <b class="alert">Learned Optimization</b>.<br>
								$\Longrightarrow$ Recurrent Inference Machines allow us to efficiently navigate complex, non-convex posteriors.
							</li>
						</ul>
					</div>
				</div>
				<br>

				<br>
				<p class="fragment">To find our codes, go to <a href="https://github.com/DifferentiableUniverseInitiative">https://github.com/DifferentiableUniverseInitiative</a></p>


				<br>
				<br>
				<p class="fragment">Thank you ! </p>
				<br> <br> <br>
			</section>

		</div>
	</div>

	<style>
		/* .reveal .slides {
			border: 5px solid red;
			min-height: 100%;
			width: 128mm;
			height: 96mm;
		} */

		.reveal .block {
			background-color: #191919;
			margin-left: 20px;
			margin-right: 20px;
			text-align: left;
			padding-bottom: 0.1em;
		}

		.reveal .block-title {
			background-color: #333333;
			padding: 8px 35px 8px 14px;
			color: #FFAA7F;
			font-weight: bold;
		}

		.reveal .block-content {
			padding: 8px 35px 8px 14px;
		}

		.reveal .slide-title {
			border-left: 5px solid white;
			text-align: left;
			margin-left: 20px;
			padding-left: 20px;
		}

		.reveal .alert {
			color: #FFAA7F;
			font-weight: bold;
		}

		.reveal .inverted {
			filter: invert(100%);
		}

		/*
	/* .reveal .alert {
	padding:8px 35px 8px 14px; margin-bottom:18px;
	text-shadow:0 1px 0 rgba(255,255,255,1);
	border:5px solid #FFAA7F;
	-webkit-border-radius: 14px; -moz-border-radius: 14px;
	border-radius:14px
	background-position: 10px 10px;
	background-repeat: no-repeat;
	background-size: 38px;
	padding-left: 30px; /* 55px; if icon
	}
	.reveal .alert-block {padding-top:14px; padding-bottom:14px}
	.reveal .alert-block > p, .alert-block > ul {margin-bottom:1em}
	/*.reveal .alert li {margin-top: 1em}
	.reveal .alert-block p+p {margin-top:5px} */
	</style>


	<script src="reveal.js/dist/reveal.js"></script>
	<script src="reveal.js/plugin/notes/notes.js"></script>
	<script src="reveal.js/plugin/markdown/markdown.js"></script>
	<script src="reveal.js/plugin/highlight/highlight.js"></script>
	<script src="reveal.js/plugin/math/math.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			controls: false,

			autoPlayMedia: true,

			//center: false,
			hash: true,

			// Visibility rule for backwards navigation arrows; "faded", "hidden"
			// or "visible"
			controlsBackArrows: 'hidden',

			// Display a presentation progress bar
			progress: true,

			// Display the page number of the current slide
			slideNumber: true,

			transition: 'slide', // none/fade/slide/convex/concave/zoom

			// The "normal" size of the presentation, aspect ratio will be preserved
			// when the presentation is scaled to fit different resolutions. Can be
			// specified using percentage units.
			width: 1280,
			height: 720,

			// Factor of the display size that should remain empty around the content
			margin: 0.1,

			// Bounds for smallest/largest possible scale to apply to content
			minScale: 0.2,
			maxScale: 1.5,


			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes, RevealMath],

			dependencies: [{
					src: 'reveal.js/plugin/markdown/marked.js'
				},
				{
					src: 'reveal.js/plugin/markdown/markdown.js'
				},
				{
					src: 'reveal.js/plugin/notes/notes.js',
					async: true
				},
				{
					src: 'reveal.js/plugin/math/math.js',
					async: true
				},
				{
					src: 'reveal.js/plugin/reveal.js-d3/reveald3.js'
				},
				{
					src: 'reveal.js/plugin/reveal.js-plugins/chart/Chart.min.js'
				},
				{
					src: 'reveal.js/plugin/reveal.js-plugins/chart/csv2chart.js'
				},
				{
					src: 'reveal.js/plugin/highlight/highlight.js',
					async: true
				},
			]

		});
	</script>
</body>

</html>